Polymer("majvj-suite",{width:0,height:0,type:"frame",name:undefined,options:undefined,base:"",ready:function(){var e=this.$.majvj,t=e.core,n=t.tma,r=t.TmaScreen,i=t.Tma2DScreen,s=t.Tma3DScreen,o=t.TmaModelPrimitives,u=t.TmaParticle,a=t.TmaSequencer,f=t.TmaMotionBvh,l=t.TmaModelPly,c=t.TmaModelPs2Ico,h=e.MajVj,p=e.vec2,d=e.vec3,v=e.vec4,m=e.mat2,g=e.mat3,y=e.mat4,b=e.quat4;h.loadScript=function(e,t,r){return n.log("all script should be preloaded to avoid name space pollution: ignore MajVj.loadScript("+e+", "+t+", "+r+");"),new Promise(function(e,t){e()})},h.effect.tuning=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.effect.tuning._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.effect.tuning._fragmentShader)),this._coords=this._screen.createBuffer([0,0,0,1,1,1,1,0])},h.effect.tuning._vertexShader=null,h.effect.tuning._fragmentShader=null,h.effect.tuning.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("effect","tuning","shaders.html","vertex"),h.loadShader("effect","tuning","shaders.html","fragment")]).then(function(t){h.effect.tuning._vertexShader=t[0],h.effect.tuning._fragmentShader=t[1],e()},function(){t("tuning.load fails")})})},h.effect.tuning.prototype.onresize=function(e){},h.effect.tuning.prototype.draw=function(e,t){var n=0;this._controller&&this._controller.volume&&(n=this._controller.volume[0]),this._program.setAttributeArray("aCoord",this._coords,0,2,0),this._program.setTexture("uTexture",t),this._program.setUniformVector("uT",[n]),this._program.drawArrays(s.MODE_TRIANGLE_FAN,0,4)},h.effect.tuning.prototype.setController=function(e){this._controller=e},h.effect.rgb=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._distance=e.distance||.1,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.effect.rgb._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.effect.rgb._fragmentShader)),this._coords=this._screen.createBuffer([0,0,0,1,1,1,1,0])},h.effect.rgb._vertexShader=null,h.effect.rgb._fragmentShader=null,h.effect.rgb.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("effect","rgb","shaders.html","vertex"),h.loadShader("effect","rgb","shaders.html","fragment")]).then(function(t){h.effect.rgb._vertexShader=t[0],h.effect.rgb._fragmentShader=t[1],e()},function(){t("rgb.load fails")})})},h.effect.rgb.prototype.onresize=function(e){},h.effect.rgb.prototype.draw=function(e,t){var n=this._distance;this._controller&&this._controller.volume&&(n=this._controller.volume[0]/2),this._program.setAttributeArray("aCoord",this._coords,0,2,0),this._program.setTexture("uTexture",t),this._program.setUniformVector("uDistance",[n]),this._program.drawArrays(s.MODE_TRIANGLE_FAN,0,4)},h.effect.rgb.prototype.setController=function(e){this._controller=e},h.effect.glow=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.effect.glow._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.effect.glow._fragmentShader)),this._noEffect=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.effect.glow._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.effect.glow._noEffectFragmentShader)),this._coords=this._screen.createBuffer([0,0,0,1,1,1,1,0])},h.effect.glow._vertexShader=null,h.effect.glow._fragmentShader=null,h.effect.glow._noEffectFragmentShader=null,h.effect.glow.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("effect","glow","shaders.html","vertex"),h.loadShader("effect","glow","shaders.html","fragment"),h.loadShader("effect","glow","shaders.html","noEffectFragment")]).then(function(t){h.effect.glow._vertexShader=t[0],h.effect.glow._fragmentShader=t[1],h.effect.glow._noEffectFragmentShader=t[2],e()},function(){t("glow.load fails")})})},h.effect.glow.prototype.onresize=function(e){},h.effect.glow.prototype.draw=function(e,t){var n=1,r=0;this._controller&&this._controller.volume&&(n=3*this._controller.volume[0],this._controller.volume.length>1&&(r=this._controller.volume[1])),n!=0?(this._program.setAttributeArray("aCoord",this._coords,0,2,0),this._program.setTexture("uTexture",t),this._program.setUniformVector("uVolume",[n]),this._program.setUniformVector("uT",[r]),this._program.drawArrays(s.MODE_TRIANGLE_FAN,0,4)):(this._noEffect.setAttributeArray("aCoord",this._coords,0,2,0),this._noEffect.setTexture("uTexture",t),this._noEffect.drawArrays(s.MODE_TRIANGLE_FAN,0,4))},h.effect.glow.prototype.setController=function(e){this._controller=e},h.effect.nicofarre=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._front=e.front!==undefined?e.front:!0,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.effect.nicofarre._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.effect.nicofarre._fragmentShader)),this._programForCeiling=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.effect.nicofarre._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.effect.nicofarre._fragmentShaderForCeiling)),this._pMatrix=y.create(),this.onresize(this._aspect),this._mvMatrix=y.create(),y.identity(this._mvMatrix);var t=e.position||[0,0,-500];y.translate(this._mvMatrix,t),this._coords=this._screen.createBuffer([420,-140,-740,420,140,-740,420,140,740,420,-140,740,-420,-140,-740,-420,140,-740,420,140,-740,420,-140,-740,-420,-140,740,-420,140,740,-420,140,-740,-420,-140,-740,420,-140,740,420,140,740,-420,140,740,-420,-140,740,260,-140,-580,260,140,-580,420,140,-580,420,-140,-580,-420,-140,-580,-420,140,-580,-260,140,-580,-260,-140,-580,-420,140,-740,-420,140,740,420,140,740,420,140,-740]),this._texCoords=this._screen.createBuffer([40/1920,760/1080,40/1920,1040/1080,1520/1920,1040/1080,1520/1920,760/1080,40/1920,120/1080,40/1920,400/1080,880/1920,400/1080,880/1920,120/1080,40/1920,440/1080,40/1920,720/1080,1520/1920,720/1080,1520/1920,440/1080,920/1920,120/1080,920/1920,400/1080,1760/1920,400/1080,1760/1920,120/1080,.8125,760/1080,.8125,1040/1080,1720/1920,1040/1080,1720/1920,760/1080,.8125,440/1080,.8125,720/1080,1720/1920,720/1080,1720/1920,440/1080,1760/1920,870/1080,1760/1920,1040/1080,1858/1920,1040/1080,1858/1920,870/1080]),this._phase=this._screen.createBuffer([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,210*Math.PI,138*Math.PI,210*Math.PI,138*Math.PI,0])},h.effect.nicofarre._vertexShader=null,h.effect.nicofarre._fragmentShader=null,h.effect.nicofarre._fragmentShaderForCeiling=null,h.effect.nicofarre.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("effect","nicofarre","shaders.html","vertex"),h.loadShader("effect","nicofarre","shaders.html","fragment"),h.loadShader("effect","nicofarre","shaders.html","fragmentForCeiling")]).then(function(t){h.effect.nicofarre._vertexShader=t[0],h.effect.nicofarre._fragmentShader=t[1],h.effect.nicofarre._fragmentShaderForCeiling=t[2],e()},function(){t("nicofarre.load fails")})})},h.effect.nicofarre.prototype.onresize=function(e){this._aspect=e,y.perspective(45,e,.1,1e4,this._pMatrix)},h.effect.nicofarre.prototype.draw=function(e,t){var n=y.create(this._mvMatrix);if(this._controller&&this._controller.volume){var r=this._controller.volume;y.translate(n,[0,0,1e3*r[0]]),y.rotate(n,Math.PI*r[1],[0,1,0])}this._screen.pushAlphaMode(),this._screen.setAlphaMode(!1),this._screen.pushCullingMode(),this._screen.setCullingMode(!0,!1),this._program.setAttributeArray("aCoord",this._coords,0,3,0),this._program.setAttributeArray("aTexCoord",this._texCoords,0,2,0),this._program.setUniformMatrix("uPMatrix",this._pMatrix),this._program.setUniformMatrix("uMVMatrix",n),this._program.setTexture("uTexture",t),this._program.drawArrays(s.MODE_TRIANGLE_FAN,0,4),this._program.drawArrays(s.MODE_TRIANGLE_FAN,4,4),this._program.drawArrays(s.MODE_TRIANGLE_FAN,8,4),this._program.drawArrays(s.MODE_TRIANGLE_FAN,12,4),this._front&&(this._program.drawArrays(s.MODE_TRIANGLE_FAN,16,4),this._program.drawArrays(s.MODE_TRIANGLE_FAN,20,4)),this._programForCeiling.setAttributeArray("aCoord",this._coords,0,3,0),this._programForCeiling.setAttributeArray("aTexCoord",this._texCoords,0,2,0),this._programForCeiling.setAttributeArray("aPhase",this._phase,0,2,0),this._programForCeiling.setUniformMatrix("uPMatrix",this._pMatrix),this._programForCeiling.setUniformMatrix("uMVMatrix",n),this._programForCeiling.setTexture("uTexture",t),this._programForCeiling.drawArrays(s.MODE_TRIANGLE_FAN,24,4),this._screen.popCullingMode(),this._screen.popAlphaMode()},h.effect.nicofarre.prototype.setController=function(e){this._controller=e},h.scene.saiyaan=function(e){this._mv=e.mv,this._controller=e.controller,this._fftController={volume:[0]},this._mixerController={volume:[0,0,0]},this._tuningController={volume:[0]},this._mixer=this._mv.create("frame","mixer",{channel:3,controller:this._mixerController}),this._waypoints=this._mv.create("frame","nicofarre3d",{modules:[{name:"waypoints",options:{particles:5e3}}]}),this._mirage=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_LEFT_STAGE_RIGHT,frames:[{name:"sandbox",options:{id:"19454.0"}}]}),this._spark=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_STAGE_AND_BACK,mirror:h.frame.nicofarre.MIRROR_ON_RIGHT,frames:[{name:"sandbox",options:{id:"14282.0"}}]}),this._city=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_STAGE,frames:[{name:"sandbox",options:{id:"18922.0"}}]}),this._tunnel=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_STAGE,frames:[{name:"sandbox",options:{id:"14373.1"}}]}),this._ceil=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_CEILING,frames:[{name:"sandbox",options:{id:"18794.0"}}]}),this._front=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_FRONT_BOTH,mirror:h.frame.nicofarre.MIRROR_ON_RIGHT,frames:[{name:"effect",options:{frames:["wired",{name:"morphere",options:{controller:this._fftController}}],effects:[{name:"tuning",options:{controller:this._tuningController}}]}}]})},h.scene.saiyaan.prototype.draw=function(e){var t=this._controller.sound.fftDb,n=t.length/4|0;this._fftController.volume[0]=t[n*3]/512;var r=0;t[n]>240&&(r=(t[n]-240)/16),this._tuningController.volume[1]=r,this._mv.screen().setAlphaMode(!1),this._mv.screen().fillColor(0,0,0,1),this._mirage.draw(e),this._ceil.draw(e),this._front.draw(e);var i=this._mixer.bind(0);this._mv.screen().setAlphaMode(!1),this._mv.screen().fillColor(0,0,0,1),this._controller.volume[2]<.1?this._mixerController.volume[0]=this._controller.volume[2]*10:this._controller.volume[2]<.2?this._mixerController.volume[0]=(.2-this._controller.volume[2])*10:this._controller.volume[2]<.3?(this._tunnel.draw(e),this._mixerController.volume[0]=(this._controller.volume[2]-.2)*10):this._controller.volume[2]<.4?(this._tunnel.draw(e),this._mixerController.volume[0]=(.4-this._controller.volume[2])*10):this._controller.volume[2]<.5?(this._city.draw(e),this._mixerController.volume[0]=(this._controller.volume[2]-.4)*10):this._controller.volume[2]<.6&&(this._city.draw(e),this._mixerController.volume[0]=(.6-this._controller.volume[2])*10),this._mixer.bind(1),this._mv.screen().setAlphaMode(!1),this._mv.screen().fillColor(0,0,0,1),this._controller.volume[2]<.1?this._mixerController.volume[1]=0:this._controller.volume[2]<.2?(this._city.draw(e),this._mixerController.volume[1]=(this._controller.volume[2]-.1)*10):this._controller.volume[2]<.3?(this._city.draw(e),this._mixerController.volume[1]=(.3-this._controller.volume[2])*10):this._controller.volume[2]<.4?this._mixerController.volume[1]=(this._controller.volume[2]-.3)*10:this._controller.volume[2]<.5?this._mixerController.volume[1]=(.5-this._controller.volume[2])*10:this._controller.volume[2]<.6?(this._tunnel.draw(e),this._mixerController.volume[1]=(this._controller.volume[2]-.5)*10):this._controller.volume[2]<.7&&(this._tunnel.draw(e),this._mixerController.volume[1]=(.7-this._controller.volume[2])*10),this._controller.volume[3]!=0&&(this._mixer.bind(2),this._mv.screen().setAlphaMode(!1),this._mv.screen().fillColor(0,0,0,1),this._mixerController.volume[2]=this._controller.volume[3],this._spark.draw(e)),i.bind(),this._mv.screen().setAlphaMode(!0,this._mv.screen().gl.ONE,this._mv.screen().gl.ONE),this._mixer.draw(e)},h.scene.noop=function(e){},h.scene.noop.prototype.draw=function(e){},h.scene.waypoints=function(e){this._mv=e.mv,this._controller=e.controller,this._tuningController={volume:[0]},this._rgbController={volume:[.01]};var t={name:"nicofarre3d",options:{modules:[{name:"waypoints",options:{size:8192,particles:300,wayspeed:50,gravity:1e3,emit:1}}]}},n={name:"tuning",options:{controller:this._tuningController}},r={name:"rgb",options:{controller:this._rgbController}};this._frame=this._mv.create("frame","effect",{frames:[t],effects:[n,r]})},h.scene.waypoints.prototype.draw=function(e){this._tuningController.volume[0]=this._controller.volume[2],this._rgbController.volume[0]=this._controller.volume[3],this._frame.draw(e)},h.scene.miku=function(e){this._mv=e.mv,this._controller=e.controller,this._fftController={sound:{fftDb:this._controller.sound.fftDb}},this._mixerController={volume:[0,0]},this._rgbController={volume:[0]},this._glowController={volume:[.02,0]};var t=h.frame.nicofarre;this._stageMixer=this._createFrame(t.LED_STAGE_AND_BACK,"effect",{frames:[{name:"mixer",options:{channel:2,controller:this._mixerController}}],effects:[{name:"glow",options:{controller:this._glowController}},{name:"rgb",options:{controller:this._rgbController}}]}),this._mixer=this._stageMixer.getFrame(0).getFrame(0),this._front=this._createSandboxFrame(t.LED_FRONT_BOTH,"18794.0"),this._fft=this._createFrame(t.LED_FRONT_BOTH,"specticle",{controller:this._fftController,color:[.1,.5,.1,1]}),this._ceil=this._createSandboxFrame(t.LED_CEILING,"18981.0"),this._wallBall=this._createSandboxFrame(t.LED_WALL_BOTH,"18451.0"),this._wallWave=this._createSandboxFrame(t.LED_WALL_BOTH,"18873.0"),this._wallPulse=this._createSandboxFrame(t.LED_WALL_BOTH,"19136.0"),this._stageNeon=this._createStageFrame("19291.0"),this._stageWarp=this._createStageFrame("19512.0"),this._stageTunnel=this._createStageFrame("19150.0"),this._stageGate=this._createStageFrame("17945.0"),this._stageCube=this._createStageFrame("18602.4t"),this._stageLight=this._createStageFrame("18770.0"),this._stageHill=this._createStageFrame("18760.0")},h.scene.miku.prototype._createStageFrame=function(e){return this._mv.create("frame","sandbox",{id:e,width:840,height:280,aspect:3})},h.scene.miku.prototype._createFrame=function(e,t,n){return this._mv.create("frame","nicofarre",{led:e,mirror:h.frame.nicofarre.MIRROR_ON_LEFT,frames:[{name:t,options:n}]})},h.scene.miku.prototype._createSandboxFrame=function(e,t){return this._createFrame(e,"sandbox",{id:t})},h.scene.miku.prototype.draw=function(e){this._glowController.volume[1]=this._controller.volume[2],this._rgbController.volume[0]=this._controller.volume[3],this._mv.screen().setAlphaMode(!1),this._mv.screen().fillColor(0,0,0,1),this._front.draw(e);var t=this._mv.screen().gl;this._mv.screen().setAlphaMode(!0,t.ONE,t.ONE),this._fft.draw(e),this._ceil.draw(e),this._wallPulse.draw(e);var n=this._mixer.bind(0);this._mv.screen().setAlphaMode(!1),this._mv.screen().fillColor(0,0,0,1),this._mv.screen().setAlphaMode(!0,t.ONE,t.ONE),this._controller.volume[1]==0?this._mixerController.volume[0]=0:this._controller.volume[1]<.1?(this._stageNeon.draw(e),this._mixerController.volume[0]=this._controller.volume[1]*10):this._controller.volume[1]<.2?(this._stageNeon.draw(e),this._mixerController.volume[0]=(.2-this._controller.volume[1])*10):this._controller.volume[1]<.3?(this._stageWarp.draw(e),this._mixerController.volume[0]=(this._controller.volume[1]-.2)*10):this._controller.volume[1]<.4?(this._stageWarp.draw(e),this._mixerController.volume[0]=(.4-this._controller.volume[1])*10):this._controller.volume[1]<.5?(this._stageTunnel.draw(e),this._mixerController.volume[0]=(this._controller.volume[1]-.4)*10):this._controller.volume[1]<.6?(this._stageTunnel.draw(e),this._mixerController.volume[0]=(.6-this._controller.volume[1])*10):this._controller.volume[1]<.7?(this._stageGate.draw(e),this._mixerController.volume[0]=(this._controller.volume[1]-.6)*10):this._controller.volume[1]<.8&&(this._stageGate.draw(e),this._mixerController.volume[0]=(.8-this._controller.volume[1])*10),this._mixer.bind(1),this._mv.screen().setAlphaMode(!1),this._mv.screen().fillColor(0,0,0,1),this._mv.screen().setAlphaMode(!0,t.ONE,t.ONE),this._controller.volume[1]<.1?this._mixerController.volume[1]=0:this._controller.volume[1]<.2?(this._stageCube.draw(e),this._mixerController.volume[1]=(this._controller.volume[1]-.1)*10):this._controller.volume[1]<.3?(this._stageCube.draw(e),this._mixerController.volume[1]=(.3-this._controller.volume[1])*10):this._controller.volume[1]<.4?(this._stageLight.draw(e),this._mixerController.volume[1]=(this._controller.volume[1]-.3)*10):this._controller.volume[1]<.5?(this._stageLight.draw(e),this._mixerController.volume[1]=(.5-this._controller.volume[1])*10):this._controller.volume[1]<.6?(this._stageHill.draw(e),this._mixerController.volume[1]=(this._controller.volume[1]-.5)*10):this._controller.volume[1]<.7&&(this._stageHill.draw(e),this._mixerController.volume[1]=(.7-this._controller.volume[1])*10),n.bind(),this._mv.screen().setAlphaMode(!0,this._mv.screen().gl.ONE,this._mv.screen().gl.ONE),this._stageMixer.draw(e)},h.scene.perfume1mm=function(e){this._mv=e.mv,this._controller=e.controller,this._sound=e.sound,this._skip=0,this._fftController={sound:{fftDb:this._controller.sound.fftDb}},this._glowController={volume:[1,0]},this._trainController={volume:[.5,0]},this._harrierController={volume:[0]},this._signalL=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_FRONT_LEFT,frames:[{name:"signal",options:{coord:[0,.2,.007],color:[0,0,0,0]}}]}),this._signalR=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_FRONT_RIGHT,frames:[{name:"signal",options:{coord:[0,.2,.007],color:[0,0,0,0]}}]}),this._signalOn=!0,this._signalC=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_CEILING,frames:[{name:"signal",options:{coord:[0,.2,.007],color:[0,0,0,0]}}]}),this._signalCeilingOn=!1,this._beams=this._mv.create("frame","nicofarre3d",{modules:[{name:"beams",options:{period:1092,unit:10}},{name:"harrier",options:{color:[.1,.1,.2],controller:this._harrierController}}]}),this._beamsOn=!1,this._screw=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_LEFT_STAGE_RIGHT,frames:[{name:"sandbox",options:{id:"19624.0"}}]}),this._screwOn=!1,this._tunnel=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_LEFT_STAGE_RIGHT,frames:[{name:"sandbox",options:{shader:h.scene.perfume1mm._shader19528}}]}),this._tunnelOn=!1,this._specticle=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_FRONT_BOTH,mirror:h.frame.nicofarre.MIRROR_ON_RIGHT,frames:[{name:"specticle",options:{color:[.7,.2,.5,1],controller:this._fftController}}]}),this._specticleOn=!1,this._wired=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_FRONT_BOTH,mirror:h.frame.nicofarre.MIRROR_ON_RIGHT,frames:[{name:"effect",options:{frames:["wired"],effects:[{name:"glow",options:{controller:this._glowController}}]}}]}),this._wiredOn=!1,this._train=this._mv.create("frame","effect",{frames:[{name:"nicofarre3d",options:{draw:this._drawMoon.bind(this),modules:[{name:"train",options:{period:273,controller:this._trainController}},{name:"beams",options:{period:500,unit:1,speed:200,dir:h.frame.nicofarre3d.modules.beams.DIR_B2F}},{name:"lines",options:{lines:1}}]}}],effects:[{name:"glow",options:{controller:this._glowController}}]}),this._trainOn=!1,this._ceil=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_CEILING,frames:[{name:"sandbox",options:{id:"18357.1"}}]}),this._ceilOn=!1,this._flare=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_CEILING,frames:[{name:"sandbox",options:{id:"1674.0"}}]}),this._flareOn=!1,this._poles=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_FRONT_BOTH,mirror:h.frame.nicofarre.MIRROR_ON_RIGHT,frames:[{name:"sandbox",options:{id:"19698.3"}}]}),this._polesOn=!1,this._moon=o.createSphere(3,o.SPHERE_METHOD_EVEN);if(h.scene.perfume1mm._moon){var t=this._mv.screen().convertImage(h.scene.perfume1mm._moon);for(var n=0;n<t.width*t.height*4;++n)t.data[n]/=8;this._moon.setTexture(this._mv.screen().createTexture(t,!0,s.FILTER_LINEAR))}this._sequencer=new a;var r=new a.SerialTask;this._sequencer.register(2e3,r),r.append(new a.Task(300,function(){var e=this._skip;e&&(e-=2.3),this._sound&&this._sound.play(h.scene.perfume1mm._sound,2,e)}.bind(this)));var i=new a.ParallelTask;i.append(new a.Task(a.Task.INFINITE,this._signalTask.bind(this))),r.append(i);var u=new a.SerialTask;i.append(u),u.append(new a.Task(2184)),u.append(new a.Task(0,function(){this._beamsOn=!0}.bind(this))),u.append(new a.Task(17472)),u.append(new a.Task(0,function(){this._specticleOn=!0}.bind(this))),u.append(new a.Task(17472)),u.append(new a.Task(0,function(){this._ceilOn=!0}.bind(this))),u.append(new a.Task(17472)),u.append(new a.Task(0,function(){this._specticleOn=!1,this._signalOn=!1,this._beamsOn=!1,this._screwOn=!0,this._polesOn=!0}.bind(this))),u.append(new a.Task(17472)),u.append(new a.Task(0,function(){this._screwOn=!1,this._polesOn=!1,this._ceilOn=!1,this._wiredOn=!0,this._tunnelOn=!0,this._flareOn=!0}.bind(this))),u.append(new a.Task(17472)),u.append(new a.Task(0,function(){this._flareOn=!1,this._tunnelOn=!1,this._screwOn=!1,this._wiredOn=!1,this._trainOn=!0,this._signalOn=!0,this._signalCeilingOn=!0}.bind(this))),u.append(new a.Task(34944)),u.append(new a.Task(0,function(){this._signalCeilingOn=!1,this._trainOn=!1,this._screwOn=!1,this._beamsOn=!0,this._ceilOn=!0}.bind(this))),u.append(new a.Task(17472)),u.append(new a.Task(0,function(){this._specticleOn=!1,this._signalOn=!1,this._beamsOn=!1,this._screwOn=!0,this._polesOn=!0}.bind(this))),u.append(new a.Task(17472)),u.append(new a.Task(0,function(){this._screwOn=!1,this._polesOn=!1,this._wiredOn=!0,this._tunnelOn=!0}.bind(this))),u.append(new a.Task(17472)),u.append(new a.Task(0,function(){this._tunnelOn=!1,this._ceilOn=!1,this._screwOn=!1,this._wiredOn=!1,this._trainOn=!0,this._signalOn=!0,this._signalCeilingOn=!0}.bind(this))),u.append(new a.Task(17472)),u.append(new a.Task(0,function(){this._trainController.volume[0]=.506}.bind(this))),u.append(new a.Task(17472)),u.append(new a.Task(0,function(){this._trainController.volume[0]=.5}.bind(this))),u.append(new a.Task(17472));var f=new a.ParallelTask;f.append(new a.Task(34944,this._flyTask.bind(this))),u.append(f),this._sequencer.run(this._skip*1e3)},h.scene.perfume1mm._sound=null,h.scene.perfume1mm._moon=null,h.scene.perfume1mm._shader19528=" precision mediump float; uniform float time; uniform vec2 resolution; float distance1(vec2 p1, vec2 p2){         return max(abs((p2-p1).x),abs((p2-p1).y)); } void main(void) {         vec2 p = gl_FragCoord.xy/resolution.xx*2.-vec2(1.0,0.1);         gl_FragColor = distance1(p,vec2(0.0))*vec4(vec3((mod(.3/distance1(p,vec2(.0))+time*.1,.1)>cos(time+p.x)*0.05+0.05)^^(mod(atan(p.y,p.x)*7./22.+time*.1,.1)>sin(time+p.y)*0.05+0.05)),1.)*.4; }",h.scene.perfume1mm.load=function(){return new Promise(function(e,t){e()})},h.scene.perfume1mm.prototype.draw=function(e){var t=0;if(this._sound){var n=this._fftController.sound.length;this._sound.normalizeFrequencyData(this._fftController.sound.fftDb[n/10|0])}this._harrierController.volume[0]=t/10,this._sequencer.run(e);var r=this._mv.screen();r.setAlphaMode(!1),r.fillColor(0,0,0,1),r.setAlphaMode(!0,r.gl.ONE,r.gl.ONE),this._screwOn&&this._screw.draw(e),this._tunnelOn&&this._tunnel.draw(e),this._trainOn&&this._train.draw(e),this._signalOn&&(this._signalL.draw(e),this._signalR.draw(e)),this._specticleOn&&this._specticle.draw(e),this._wiredOn&&this._wired.draw(e),this._polesOn&&this._poles.draw(e),this._beamsOn&&this._beams.draw(e),this._ceilOn&&this._ceil.draw(e),this._flareOn&&this._flare.draw(e),this._signalCeilingOn&&this._signalC.draw(e)},h.scene.perfume1mm.prototype._signalTask=function(e,t){var n=t/173.7,r=Math.sin(n),i=r<0?0:r,s=r<0?-r:0,o=i/4,u=s/4;this._signalL.getFrame(0).setColor([i,o,o,1]),this._signalR.getFrame(0).setColor([s,u,u,1]),this._signalC.getFrame(0).setColor([i+s,o+u,o+u,1])},h.scene.perfume1mm.prototype._flyTask=function(e,t){this._trainController.volume[1]=t/15e3},h.scene.perfume1mm.prototype._drawMoon=function(e){e.setAlphaMode(!1);var t=this._trainController.volume[1],n=(1-t)*3e3,r=-5e3+2e3*t;e.drawPrimitive(this._moon,1e3,1e3,1e3,[0,n,r],[0,Math.PI/2,0])},h.scene.computerbrain=function(e){this._mv=e.mv,this._controller=e.controller,this._stage=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_STAGE_AND_BACK,mirror:h.frame.nicofarre.MIRROR_ON_LEFT,frames:[{name:"sandbox",options:{id:"18922.0"}}]}),this._wall=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_WALL_BOTH,mirror:h.frame.nicofarre.MIRROR_ON_RIGHT,frames:[{name:"sandbox",options:{id:"18918.0"}}]}),this._side=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_FRONT_BOTH,mirror:h.frame.nicofarre.MIRROR_ON_RIGHT,frames:[{name:"sandbox",options:{id:"18451.0"}}]}),this._ceil=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_CEILING,frames:[{name:"sandbox",options:{id:"18568.0"}}]})},h.scene.computerbrain.prototype.draw=function(e){this._mv.screen().fillColor(0,0,0,1),this._stage.draw(e),this._wall.draw(e),this._side.draw(e),this._ceil.draw(e)},h.scene.lines=function(e){this._mv=e.mv,this._controller=e.controller,this._frame=this._mv.create("frame","nicofarre3d",{draw:h.scene.lines.draw3d.bind(this)})},h.scene.lines._getRandomPosition=function(){return(Math.random()-.5)*1e5},h.scene.lines.draw3d=function(e){var t=h.scene.lines._getRandomPosition;e.setAlphaMode(!0,e.gl.DST_COLOR,e.gl.ZERO);var n=.95+.049*this._controller.volume[1];e.fill([n,n,n,1]),e.setAlphaMode(!0,e.gl.ONE,e.gl.ONE);for(var r=0;r<128;++r)e.color=[Math.random(),Math.random(),Math.random(),Math.random()],e.drawLine([t(),t(),t()],[t(),t(),t()])},h.scene.lines.prototype.draw=function(e){this._frame.draw(e)},h.scene.white=function(e){this._mv=e.mv},h.scene.white.prototype.draw=function(e){this._mv.screen().setAlphaMode(!1),this._mv.screen().fillColor(1,1,1,1)},h.scene.church=function(e){this._mv=e.mv,this._controller=e.controller,this._frame=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_WHOLE_WALLS,frames:[{name:"sandbox",options:{shader:h.scene.church.shader}}]})},h.scene.church.prototype.draw=function(e){this._mv.screen().setAlphaMode(!1),this._frame.draw(e)},h.scene.church.shader=" precision mediump float; uniform float time; uniform vec2 resolution; void main( void ) {   vec2 coord = gl_FragCoord.xy / resolution * 3.141592 * 2.0;   float dr = sin(coord.x * 10.0 + time * 3.0) - sin(coord.y + time * 10.0);   float dg =       sin(coord.x * 20.0 - time * 2.0) - sin(coord.y * 2.0 + time * 5.0);   float db = sin(coord.x * 15.0 - time) - sin(coord.y * 1.5 + time * 7.0);   float er = sin(coord.x * 12.0 + time * 5.0) - sin(coord.y + time * 11.0);   float eg =       sin(coord.x * 22.0 - time * 1.0) - sin(coord.y * 2.0 + time * 9.0);   float eb =       sin(coord.x * 32.0 - time * 4.0) - sin(coord.y * 1.5 + time * 3.0);   float r = dr * dg * er * eg;   float g = dg * db * eg * eb;   float b = db * dr * eb * er;   gl_FragColor = vec4(r, g, b, 1.0); }",h.scene.dreamcube=function(e){this._mv=e.mv,this._controller=e.controller;var t={name:"nicofarre3d",options:{module:"cube"}};this._frame=this._mv.create("frame","effect",{frames:[t],effects:["glow"]})},h.scene.dreamcube.prototype.draw=function(e){this._frame.draw(e)},h.scene.roll=function(e){this._mv=e.mv,this._controller=e.controller,this._fftController={sound:{fftDb:this._controller.sound.fftDb}},this._front=this._mv.create("frame","nicofarre",{led:h.frame.nicofarre.LED_FRONT_BOTH,frames:[{name:"specticle",options:{random:.3,color:[.1,.1,.3,1],controller:this._fftController}}]}),this._frame=this._mv.create("frame","nicofarre3d",{modules:[{name:"waypoints",options:{size:8192,height:4096,particles:1e3,waypoints:16,wayspeed:70,gravity:10,range:1e6,emit:1}},{name:"roll",options:{script:e.script||h.scene.roll._script,delay:0,font:{size:70,name:"Sans",foreground:"rgba(76, 38, 51, 200)",background:"rgba(0, 0, 0, 255)"},headFont:{size:90,name:"Sans",foreground:"rgba(76, 51, 76, 200)",background:"rgba(0, 0, 0, 255)"}}}]})},h.scene.roll.prototype.draw=function(e){this._mv.screen().setAlphaMode(!1),this._frame.draw(e),this._front.draw(e)},h.scene.roll._script=[{head:!0,text:"End Roll"},{text:"This is a sample script"},{text:""},{text:"by toyoshim"}],h.misc.sound=function(e){this._channel=e.channel||1,h.misc.sound._context||(h.misc.sound._context=new AudioContext),this._audio=h.misc.sound._context,this._gain=new Array(this._channel);for(var t=0;t<this._channel;++t)this._gain[t]=this._audio.createGain();this._splitter=this._audio.createChannelSplitter(2),this._analyser=this._audio.createAnalyser(),this._leftAnalyser=this._audio.createAnalyser(),this._rightAnalyser=this._audio.createAnalyser(),this._delay=this._audio.createDelay(),e.delay&&(this._delay.delayTime.value=e.delay),this._buffer=new Array(this._channel),this._playing=0,e.url&&this.fetch(e.url,e.play)},h.misc.sound.load=function(){return new Promise(function(e,t){if(!h.misc.sound.useMicrophone){e();return}navigator.webkitGetUserMedia({audio:!0},function(t){h.misc.sound._microphone=t,e()}.bind(this),function(e){t(e)})})},h.misc.sound.useMicrophone=h.getSetting("misc","sound","useMicrophone",!1),h.misc.sound._microphone=null,h.misc.sound._context=null,h.misc.sound.prototype.fetch=function(e,t){return this._play=t||!1,new Promise(function(t,r){var i=n.fetch(e);i.then(function(e){this._audio.decodeAudioData(e,function(e){this._data=e,this._play&&this.play(),t(e)}.bind(this),function(e){n.log(e)})}.bind(this),r)}.bind(this))},h.misc.sound.prototype.play=function(e,t,n){if(!this._data&&!e)return!1;var r=t||0;return r>=this._channel?!1:(this.stop(r),this._buffer[r]=this._audio.createBufferSource(),this._buffer[r].buffer=e||this._data,this._connect(r,!0,n),!0)},h.misc.sound.prototype.capture=function(e){var t=e||0;return t>=this._channel?!1:(this.stop(t),this._buffer[t]=this._audio.createMediaStreamSource(h.misc.sound._microphone),this._connect(t,!1),!0)},h.misc.sound.prototype._connect=function(e,t,n){this._buffer[e].connect(this._gain[e]),this._gain[e].connect(this._analyser),this._gain[e].connect(this._delay),this._gain[e].connect(this._splitter),this._playing==0&&(this._splitter.connect(this._leftAnalyser,0),this._splitter.connect(this._rightAnalyser,1),t&&this._delay.connect(this._audio.destination)),t&&this._buffer[e].start(0,n||0),this._playing++},h.misc.sound.prototype.stop=function(e){var t=e||0;if(t>this._channel)return;if(!this._buffer[t])return;this._buffer[t].stop&&this._buffer[t].stop(),this._buffer[t].disconnect(),this._gain[t].disconnect(),this._buffer[t]=null,this._playing--,this._playing==0&&(this._splitter.disconnect(),this._delay.disconnect())},h.misc.sound.prototype.setGain=function(e,t){var n=t||0;if(n>this._channel)return;this._gain[n].gain.value=e},h.misc.sound.prototype.setDelay=function(e){this._delay.delayTime.value=e},h.misc.sound.prototype.getFftCount=function(){return this._analyser.frequencyBinCount/2},h.misc.sound.prototype.normalizeFrequencyData=function(e){var t=this._analyser;return(e-t.minDecibels)/(t.maxDecibels-t.minDecibels)},h.misc.sound.prototype.getByteFrequencyData=function(e,t){t?(this._leftAnalyser.getByteFrequencyData(e),this._rightAnalyser.getByteFrequencyData(t)):this._analyser.getByteFrequencyData(e)},h.misc.sound.prototype.getFloatFrequencyData=function(e,t){t?(this._leftAnalyser.getFloatFrequencyData(e),this._rightAnalyser.getFloatFrequencyData(t)):this._analyser.getFloatFrequencyData(e)},h.frame.sandbox=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._time=0,this._program=null,e.id?this.setShader(e.id):e.shader&&this.setShader(e.shader),this._coords=this._screen.createBuffer([-1,-1,-1,1,1,1,1,-1])},h.frame.sandbox._vertexShader=null,h.frame.sandbox._fragmentShaders={},h.frame.sandbox.load=function(){return new Promise(function(
e,t){Promise.all([h.loadShader("frame","sandbox","shaders.html","vertex"),h.loadShader("frame","sandbox","shaders.html","19291.0"),h.loadShader("frame","sandbox","shaders.html","18918.0"),h.loadShader("frame","sandbox","shaders.html","18922.0"),h.loadShader("frame","sandbox","shaders.html","18916.0"),h.loadShader("frame","sandbox","shaders.html","18713.0"),h.loadShader("frame","sandbox","shaders.html","18613.0"),h.loadShader("frame","sandbox","shaders.html","18568.0"),h.loadShader("frame","sandbox","shaders.html","18451.0"),h.loadShader("frame","sandbox","shaders.html","19297.0"),h.loadShader("frame","sandbox","shaders.html","18759.0"),h.loadShader("frame","sandbox","shaders.html","19336.0"),h.loadShader("frame","sandbox","shaders.html","18981.0"),h.loadShader("frame","sandbox","shaders.html","18543.2"),h.loadShader("frame","sandbox","shaders.html","19674.0"),h.loadShader("frame","sandbox","shaders.html","19624.0"),h.loadShader("frame","sandbox","shaders.html","18357.1"),h.loadShader("frame","sandbox","shaders.html","18794.0"),h.loadShader("frame","sandbox","shaders.html","1674.0"),h.loadShader("frame","sandbox","shaders.html","19689.0"),h.loadShader("frame","sandbox","shaders.html","19528.0"),h.loadShader("frame","sandbox","shaders.html","19698.3"),h.loadShader("frame","sandbox","shaders.html","19454.0"),h.loadShader("frame","sandbox","shaders.html","14282.0"),h.loadShader("frame","sandbox","shaders.html","14373.1"),h.loadShader("frame","sandbox","shaders.html","19512.0"),h.loadShader("frame","sandbox","shaders.html","19150.0"),h.loadShader("frame","sandbox","shaders.html","19136.0"),h.loadShader("frame","sandbox","shaders.html","18981.0"),h.loadShader("frame","sandbox","shaders.html","18873.0"),h.loadShader("frame","sandbox","shaders.html","18770.0"),h.loadShader("frame","sandbox","shaders.html","18760.0"),h.loadShader("frame","sandbox","shaders.html","18602.4"),h.loadShader("frame","sandbox","shaders.html","18602.4t"),h.loadShader("frame","sandbox","shaders.html","18142.0"),h.loadShader("frame","sandbox","shaders.html","17945.0")]).then(function(t){h.frame.sandbox._vertexShader=t[0],h.frame.sandbox._fragmentShaders["19291.0"]=t[1],h.frame.sandbox._fragmentShaders["18918.0"]=t[2],h.frame.sandbox._fragmentShaders["18922.0"]=t[3],h.frame.sandbox._fragmentShaders["18916.0"]=t[4],h.frame.sandbox._fragmentShaders["18713.0"]=t[5],h.frame.sandbox._fragmentShaders["18613.0"]=t[6],h.frame.sandbox._fragmentShaders["18568.0"]=t[7],h.frame.sandbox._fragmentShaders["18451.0"]=t[8],h.frame.sandbox._fragmentShaders["19297.0"]=t[9],h.frame.sandbox._fragmentShaders["18759.0"]=t[10],h.frame.sandbox._fragmentShaders["19336.0"]=t[11],h.frame.sandbox._fragmentShaders["18981.0"]=t[12],h.frame.sandbox._fragmentShaders["18543.2"]=t[13],h.frame.sandbox._fragmentShaders["19674.0"]=t[14],h.frame.sandbox._fragmentShaders["19624.0"]=t[15],h.frame.sandbox._fragmentShaders["18357.1"]=t[16],h.frame.sandbox._fragmentShaders["18794.0"]=t[17],h.frame.sandbox._fragmentShaders["1674.0"]=t[18],h.frame.sandbox._fragmentShaders["19689.0"]=t[19],h.frame.sandbox._fragmentShaders["19528.0"]=t[20],h.frame.sandbox._fragmentShaders["19698.3"]=t[21],h.frame.sandbox._fragmentShaders["19454.0"]=t[22],h.frame.sandbox._fragmentShaders["14282.0"]=t[23],h.frame.sandbox._fragmentShaders["14373.1"]=t[24],h.frame.sandbox._fragmentShaders["19512.0"]=t[25],h.frame.sandbox._fragmentShaders["19150.0"]=t[26],h.frame.sandbox._fragmentShaders["19136.0"]=t[27],h.frame.sandbox._fragmentShaders["18981.0"]=t[28],h.frame.sandbox._fragmentShaders["18873.0"]=t[29],h.frame.sandbox._fragmentShaders["18770.0"]=t[30],h.frame.sandbox._fragmentShaders["18760.0"]=t[31],h.frame.sandbox._fragmentShaders["18602.4"]=t[32],h.frame.sandbox._fragmentShaders["18602.4t"]=t[33],h.frame.sandbox._fragmentShaders["18142.0"]=t[34],h.frame.sandbox._fragmentShaders["17945.0"]=t[35],e()},function(e){n.log(e)})})},h.frame.sandbox.prototype.onresize=function(e){this._aspect=e},h.frame.sandbox.prototype.draw=function(e){this._time+=e/1e3,this._program.setAttributeArray("aCoord",this._coords,0,2,0),this._program.setUniformVector("time",[this._time]),this._program.setUniformVector("mouse",[.5,.5]),this._program.setUniformVector("resolution",[this._width,this._height]),this._program.drawArrays(s.MODE_TRIANGLE_FAN,0,4)},h.frame.sandbox.prototype.setController=function(e){this._controller=e},h.frame.sandbox.prototype.setShader=function(e){var t=h.frame.sandbox._fragmentShaders[e];t||(t=e),this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.sandbox._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,t))},h.frame.crlogo=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.crlogo._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.crlogo._fragmentShader)),this._pMatrix=y.create(),this._mvMatrix=y.create(),this._rotate=0;var t=h.frame.crlogo._logos[0];this._vertices=this._screen.createBuffer(t.vertices),this._vertices.items=t.items,this._offsets=this._screen.createBuffer(t.offsets),this._colors=this._screen.createBuffer(t.colors),this._ps=new h.frame.crlogo.ps(this,0),this.onresize(this._aspect),y.identity(this._mvMatrix)},h.frame.crlogo._createLogo=function(e){return new Promise(function(t,r){h.loadImage("frame","crlogo",e).then(function(r){n.log("generating "+r.width+"x"+r.height+" particles from "+e);var i=document.createElement("canvas");i.width=r.width,i.height=r.height;var s=i.getContext("2d");s.drawImage(r,0,0,r.width,r.height);var o=s.getImageData(0,0,r.width,r.height).data,u=function(e,t){var n=e|0,s=t|0;if(n<0||s<0||n>=i.width||s>=i.height)return[0,0,0,0];var u=s*r.width+n,a=u*4;return[o[a+0]/255,o[a+1]/255,o[a+2]/255,o[a+3]/255]},a=Math.max(r.width,r.height),f=(r.width-a)/2,l=(r.height-a)/2,c=48,p=4,d=a/c,v=l,m=[];for(var g=0;g<c;++g){var y=f;for(var b=0;b<c;++b){var w=u(y,v);y+=d;var E=b-c/2-.5,S=c/2-g-.5;E*=p,S*=p,w[0]>.7&&w[1]>.7&&w[2]>.7||w[0]<.3&&w[1]<.3&&w[2]<.3||w[3]<.3?m.push([E,S,1,1,1,0]):m.push([E,S,w[0],w[1],w[2],w[3]])}v+=d}var x=m.length,T=h.frame.crlogo._createVertices(m),N=h.frame.crlogo._resolution*3*x,C=h.frame.crlogo._createOffsets(m),k=h.frame.crlogo._createColors(m);t({raw:m,vertices:T,items:N,offsets:C,colors:k})},function(e){r(e)})})},h.frame.crlogo._createVertices=function(e){var t=h.frame.crlogo._circle.length,n=t*e.length,r=new Array(n);for(var i=0;i<n;i+=t)for(var s=0;s<t;++s)r[i+s]=h.frame.crlogo._circle[s];return r},h.frame.crlogo._createOffsets=function(e){var t=h.frame.crlogo._resolution*3,n=e.length*3*t,r=new Array(n);for(var i=0;i<e.length;i++){var s=e[i],o=i*3*t;for(var u=0;u<3*t;u+=3)r[o+u+0]=s[0],r[o+u+1]=s[1],r[o+u+2]=0}return r},h.frame.crlogo._createColors=function(e){var t=h.frame.crlogo._resolution*3,n=e.length*4*t,r=new Array(n);for(var i=0;i<e.length;i++){var s=e[i],o=i*4*t;for(var u=0;u<4*t;u+=4)r[o+u+0]=s[2],r[o+u+1]=s[3],r[o+u+2]=s[4],r[o+u+3]=s[5]}return r},h.frame.crlogo._vertexShader=null,h.frame.crlogo._fragmentShader=null,h.frame.crlogo._logos=[],h.frame.crlogo._resolution=4,h.frame.crlogo._circle=function(){var e=[],t=h.frame.crlogo._resolution;for(var n=0;n<t;++n){e=e.concat([0,0,0]);var r=2*Math.PI*n/t;e=e.concat([Math.cos(r),Math.sin(r),0]),r=2*Math.PI*(n+1)/t,e=e.concat([Math.cos(r),Math.sin(r),0])}return e}(),h.frame.crlogo.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","crlogo","shaders.html","vertex"),h.loadShader("frame","crlogo","shaders.html","fragment"),h.frame.crlogo._createLogo("logo0.jpg"),h.frame.crlogo._createLogo("logo1.jpg")]).then(function(t){h.frame.crlogo._vertexShader=t[0],h.frame.crlogo._fragmentShader=t[1],h.frame.crlogo._logos[0]=t[2],h.frame.crlogo._logos[1]=t[3],e()},function(e){t(e)})})},h.frame.crlogo.prototype.onresize=function(e){y.perspective(45,e,.1,1e3,this._pMatrix),y.translate(this._pMatrix,[0,0,-250]),y.rotate(this._pMatrix,this._rotate,[.1,.2,0])},h.frame.crlogo.prototype.draw=function(e){this._program.setUniformMatrix("uMVMatrix",this._mvMatrix);var t=.002*e;this._controller&&this._controller.slider&&(t*=.5+this._controller.slider*1.5),this._rotate+=t,y.rotate(this._pMatrix,t,[.1,.2,0]),this._program.setUniformMatrix("uPMatrix",this._pMatrix),this._program.setAttributeArray("aVertexPosition",this._vertices,0,3,0),this._program.setAttributeArray("aVertexOffset",this._offsets,0,3,0),this._program.setAttributeArray("aColor",this._colors,0,4,0),this._program.drawArrays(s.MODE_TRIANGLES,0,this._vertices.items),this._ps.update(e)},h.frame.crlogo.prototype.setController=function(e){this._controller&&(this._controller.onsolo=null,this._controller.onmute=null,this._controller.onrecord=null),this._controller=e;if(!e)return;this._controller.onsolo=function(e){if(!e)return;this.crash()}.bind(this._ps),this._controller.onmute=function(e){if(!e)return;this._mode=1}.bind(this._ps)},h.frame.crlogo.ps=function(e,t){this._random=Math.random,this._PI=Math.PI,this._sin=Math.sin,this._cos=Math.cos,this._pow=Math.pow,this._parent=e,this._index=t,this._data=h.frame.crlogo._logos[t].raw,this._mode=0,this._autoCount=0,this._morph=!1,this._morphSrc=null,this._morphDst=null,this._morphSpeed=0,this._morphCount=0,this._morphIndex=0,this._length=this._data.length,this._x=new Float32Array(this._length),this._y=new Float32Array(this._length),this._z=new Float32Array(this._length),this._bx=new Float32Array(this._length),this._by=new Float32Array(this._length),this._bz=new Float32Array(this._length),this._vx=new Float32Array(this._length),this._vy=new Float32Array(this._length),this._vz=new Float32Array(this._length),this._gx=0,this._gy=0,this._gz=0,this._rx=0,this._ry=0;for(var n=0;n<this._length;++n){var r=this._data[n];this._x[n]=r[0],this._y[n]=r[1],this._z[n]=0,this._bx[n]=r[0],this._by[n]=r[1],this._bz[n]=0,this._vx[n]=0,this._vy[n]=0,this._vz[n]=0}},h.frame.crlogo.ps.prototype.crash=function(){this._mode=0;for(var e=0;e<this._length;++e)this._vx[e]=this._random()*100-50,this._vy[e]=this._random()*100-50,this._vz[e]=this._random()*100-50},h.frame.crlogo.ps.prototype.pilot=function(){if(this._autoCount>0){this._autoCount--;return}var e=Math.random()*100;this._parent._controller&&this._parent._controller.knob&&(e/=this._parent._controller.knob*2.2+.2),this._mode=Math.floor(Math.random()*4),this._mode==0&&(e*=1.6),this._autoCount=Math.floor(e),this._mode==2&&this.crash(),this._mode==3&&this.autoMorph(!1)},h.frame.crlogo.ps.prototype.autoMorph=function(e){if(!e&&Math.random()>.1){this._mode=0;return}if(this._morph)return;var t=this._morphIndex;this._morphIndex++,this._morphIndex==h.frame.crlogo._logos.length&&(this._morphIndex=0);var n=this._morphIndex;this.morph(h.frame.crlogo._logos[t].colors,h.frame.crlogo._logos[n].colors,.3),this._mode=0},h.frame.crlogo.ps.prototype.morph=function(e,t,r){if(e.length!=t.length){n.log("image size is different");return}this._morphSrc=e,this._morphDst=t,this._morphCount=0,this._morphSpeed=r,this._morph=!0},h.frame.crlogo.ps.prototype.update=function(e){this.pilot();if(this._morph){this._morphCount+=this._morphSpeed*e;var t=this._morphCount/1e3;t>=1&&(t=1,this._morph=!1);var n=this._parent._colors.buffer(),r=1-t,i=t,s=this._morphSrc.length;for(var o=0;o<s;++o)n[o]=this._morphSrc[o]*r+this._morphDst[o]*i;this._parent._colors.update()}var u=this._parent._offsets.buffer(),a=h.frame.crlogo._resolution*3,o;this._rx+=2e-4*e,this._ry+=4e-4*e;var f=2*this._PI*this._rx/360,l=2*this._PI*this._ry/360;this._gx=this._sin(f)*this._sin(l),this._gy=this._cos(f),this._gz=-this._sin(f)*this._cos(l);if(this._mode==0){var c=this._pow(.9,e/30),p=.01*e/30;for(o=0;o<this._length;++o)this._vx[o]*=c,this._vy[o]*=c,this._vz[o]*=c,this._vx[o]+=(this._bx[o]-this._x[o])*p,this._vy[o]+=(this._by[o]-this._y[o])*p,this._vz[o]+=(this._bz[o]-this._z[o])*p}else{var d=this._gx*e/30,v=this._gy*e/30,m=this._gz*e/30,g=100;for(o=0;o<this._length;++o)this._x[o]<-g||g<this._x[o]?this._vx[o]*=-1:this._vx[o]+=d,this._y[o]<-g||g<this._y[o]?this._vy[o]*=-1:this._vy[o]+=v,this._z[o]<-g||g<this._z[o]?this._vz[o]*=-1:this._vz[o]+=m}var y=0,b=1;window.player&&player.average&&(b=1+player.average/10);for(o=0;o<this._length;++o){this._x[o]+=this._vx[o],this._y[o]+=this._vy[o],this._z[o]+=this._vz[o];for(var w=0;w<a;w++)u[y+0]=this._x[o]*b,u[y+1]=this._y[o]*b,u[y+2]=this._z[o]*b,y+=3}this._parent._offsets.update()},h.frame.mixer=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._channel=e.channel||1;var t=this._channel==1?h.frame.mixer._fragment1Shader:this._channel==2?h.frame.mixer._fragment2Shader:h.frame.mixer._fragment3Shader;this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.mixer._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,t)),this._coords=this._screen.createBuffer([0,0,0,1,1,1,1,0]),this._fbo=[];for(var n=0;n<this._channel;++n)this._fbo[n]=this._screen.createFrameBuffer(this._width,this._height)},h.frame.mixer._vertexShader=null,h.frame.mixer._fragment1Shader=null,h.frame.mixer._fragment2Shader=null,h.frame.mixer._fragment3Shader=null,h.frame.mixer.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","mixer","shaders.html","vertex"),h.loadShader("frame","mixer","shaders.html","fragment1"),h.loadShader("frame","mixer","shaders.html","fragment2"),h.loadShader("frame","mixer","shaders.html","fragment3")]).then(function(t){h.frame.mixer._vertexShader=t[0],h.frame.mixer._fragment1Shader=t[1],h.frame.mixer._fragment2Shader=t[2],h.frame.mixer._fragment3Shader=t[3],e()},function(){t("mixer.load fails")})})},h.frame.mixer.prototype.onresize=function(e){},h.frame.mixer.prototype.draw=function(e,t,n,r){this._program.setAttributeArray("aCoord",this._coords,0,2,0),this._program.setTexture("uTexture0",this._fbo[0].texture),this._program.setUniformVector("uVolume0",[this._controller.volume[0]]),this._channel>=2&&(this._program.setTexture("uTexture1",this._fbo[1].texture),this._program.setUniformVector("uVolume1",[this._controller.volume[1]]),this._channel>=3&&(this._program.setTexture("uTexture2",this._fbo[2].texture),this._program.setUniformVector("uVolume2",[this._controller.volume[2]]))),this._program.drawArrays(s.MODE_TRIANGLE_FAN,0,4)},h.frame.mixer.prototype.setController=function(e){this._controller=e},h.frame.mixer.prototype.bind=function(e){return this._fbo[e].bind()},h.frame.nicofarre3d=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._clearCallback=e.clear,this._drawCallback=e.draw,this._modules=[],this._api={clear:this._clear.bind(this),color:[1,1,1,1],createFont:this._createFont.bind(this),createTexture:this._screen.createTexture,delta:0,drawBox:this._drawBox.bind(this),drawCharacter:this._drawCharacter.bind(this),drawCube:this._drawCube.bind(this),drawLine:this._drawLine.bind(this),drawPrimitive:this._drawPrimitive.bind(this),fill:this._fill.bind(this),gl:this._screen.gl,screen:this._screen,setAlphaMode:this._screen.setAlphaMode},this._screenProgram=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.nicofarre3d._vScreenShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.nicofarre3d._fScreenShader)),this._drawProgram=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.nicofarre3d._vDrawShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.nicofarre3d._fDrawShader)),this._textureProgram=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.nicofarre3d._vTextureShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.nicofarre3d._fTextureShader)),this._pointProgram=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.nicofarre3d._vPointShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.nicofarre3d._fPointShader)),this._coords=this._screen.createBuffer([40/1920*2-1,760/1080*2-1,40/1920*2-1,1040/1080*2-1,1520/1920*2-1,1040/1080*2-1,1520/1920*2-1,760/1080*2-1,40/1920*2-1,120/1080*2-1,40/1920*2-1,400/1080*2-1,880/1920*2-1,400/1080*2-1,880/1920*2-1,120/1080*2-1,40/1920*2-1,440/1080*2-1,40/1920*2-1,720/1080*2-1,1520/1920*2-1,720/1080*2-1,1520/1920*2-1,440/1080*2-1,920/1920*2-1,120/1080*2-1,920/1920*2-1,400/1080*2-1,1760/1920*2-1,400/1080*2-1,1760/1920*2-1,120/1080*2-1,.625,760/1080*2-1,.625,1040/1080*2-1,1720/1920*2-1,1040/1080*2-1,1720/1920*2-1,760/1080*2-1,.625,440/1080*2-1,.625,720/1080*2-1,1720/1920*2-1,720/1080*2-1,1720/1920*2-1,440/1080*2-1]),this._texCoods=this._screen.createBuffer([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]);var t=this._width/1920,n=280*this._height/1080;this._fboRight=this._screen.createFrameBuffer(1480*t,n),this._fboStage=this._screen.createFrameBuffer(840*t,n),this._fboLeft=this._screen.createFrameBuffer(1480*t,n),this._fboBack=this._screen.createFrameBuffer(840*t,n);var r=Math.atan(1480/840)*180/Math.PI,i=180-r*2,u=180-i,a=[3,3,1],f=[1480/280,1480/280,1];this._pMatrixRight=y.scale(y.perspective(u,1480/280,420,1e5),f),this._pMatrixStage=y.scale(y.perspective(i,3,740,1e5),a),this._pMatrixLeft=y.scale(y.perspective(u,1480/280,420,1e5),f),this._pMatrixBack=y.scale(y.perspective(i,3,740,1e5),a),this._mvMatrixRight=y.rotateY(y.identity(),Math.PI/2),this._mvMatrixStage=y.identity(),this._mvMatrixLeft=y.rotateY(y.identity(),-Math.PI/2),this._mvMatrixBack=y.rotateY(y.identity(),-Math.PI),this._iMatrix=y.identity(),this._matrix=y.create(),this._buffer2=this._screen.createBuffer(new Array(6)),this._bufferICoord=this._screen.createBuffer([-1,-1,1,-1,1,1,1,1,1,1,-1,1]),this._box=o.createBox(),this._cube=o.createCube();if(e.module){var l=e.options||{};l.screen=this._screen,l.api=this._api,this._modules[0]=new h.frame.nicofarre3d.modules[e.module](l)}else if(e.modules)for(var c=0;c<e.modules.length;++c){var p=e.modules[c],l=p.options||{};l.screen=this._screen,l.api=this._api,this._modules[c]=new h.frame.nicofarre3d.modules[p.name](l)}},h.frame.nicofarre3d.modules={},h.frame.nicofarre3d._vScreenShader=null,h.frame.nicofarre3d._fScreenShader=null,h.frame.nicofarre3d._vDrawShader=null,h.frame.nicofarre3d._fDrawShader=null,h.frame.nicofarre3d._vTextureShader=null,h.frame.nicofarre3d._fTextureShader=null,h.frame.nicofarre3d._vPointShader=null,h.frame.nicofarre3d._fPointShader=null,h.frame.nicofarre3d.load=function(){return new Promise(function(e,t){var n="nicofarre3d",r="shaders.html";Promise.all([h.loadShader("frame",n,r,"v_screen"),h.loadShader("frame",n,r,"f_screen"),h.loadShader("frame",n,r,"v_draw"),h.loadShader("frame",n,r,"f_draw"),h.loadShader("frame",n,r,"v_texture"),h.loadShader("frame",n,r,"f_texture"),h.loadShader("frame",n,r,"v_point"),h.loadShader("frame",n,r,"f_point"),h.loadScript("frame",n,"cube.js"),h.loadScript("frame",n,"waypoints.js"),h.loadScript("frame",n,"beams.js"),h.loadScript("frame",n,"train.js"),h.loadScript("frame",n,"lines.js"),h.loadScript("frame",n,"harrier.js"),h.loadScript("frame",n,"roll.js")]).then(function(t){h.frame.nicofarre3d._vScreenShader=t[0],h.frame.nicofarre3d._fScreenShader=t[1],h.frame.nicofarre3d._vDrawShader=t[2],h.frame.nicofarre3d._fDrawShader=t[3],h.frame.nicofarre3d._vTextureShader=t[4],h.frame.nicofarre3d._fTextureShader=t[5],h.frame.nicofarre3d._vPointShader=t[6],h.frame.nicofarre3d._fPointShader=t[7],e()},function(){t("nicofarre3d.load fails")})})},h.frame.nicofarre3d.prototype.onresize=function(e){this._aspect=e},h.frame.nicofarre3d.prototype.draw=function(e){this._screen.pushAlphaMode();var t=this._fboRight.bind();this._api.delta=e,this._clearCallback?this._clearCallback(this._api):this._modules.length>0&&this._modules[0].clear(this._api);for(var n=0;n<this._modules.length;++n)this._modules[n].draw(this._api);this._drawCallback&&this._drawCallback(this._api),t.bind(),this._screen.popAlphaMode(),this._screenProgram.setAttributeArray("aCoord",this._coords,0,2,0),this._screenProgram.setAttributeArray("aTexCoord",this._texCoods,0,2,0),this._screenProgram.setTexture("uTexture",this._fboRight.texture),this._screenProgram.drawArrays(s.MODE_TRIANGLE_FAN,0,4),this._screenProgram.setTexture("uTexture",this._fboStage.texture),this._screenProgram.drawArrays(s.MODE_TRIANGLE_FAN,4,4),this._screenProgram.setTexture("uTexture",this._fboLeft.texture),this._screenProgram.drawArrays(s.MODE_TRIANGLE_FAN,8,4),this._screenProgram.setTexture("uTexture",this._fboBack.texture),this._screenProgram.drawArrays(s.MODE_TRIANGLE_FAN,12,4)},h.frame.nicofarre3d.prototype.setController=function(e){this._controller=e},h.frame.nicofarre3d.prototype._clear=function(e){this._screen.gl.clearColor(this._api.color[0],this._api.color[1],this._api.color[2],this._api.color[3]),this._fboRight.bind(),this._screen.gl.clear(e),this._fboStage.bind(),this._screen.gl.clear(e),this._fboLeft.bind(),this._screen.gl.clear(e),this._fboBack.bind(),this._screen.gl.clear(e)},h.frame.nicofarre3d.prototype._drawBox=function(e,t,n,r,i){return this._box.setTexture(i),this._drawPrimitive(this._box,e,t,1,n,r)},h.frame.nicofarre3d.prototype._drawCharacter=function(e,t,n,r,i,s){var o=e[t];this._box.setTexture(o);var u=o.width*n,a=o.height*r;return this._drawPrimitive(this._box,u,a,1,i,s)},h.frame.nicofarre3d.prototype._drawCube=function(e,t,n,r,i){return this._drawPrimitive(this._cube,e,t,n,r,i)},h.frame.nicofarre3d.prototype._drawLine=function(e,t){var n=this._buffer2.buffer();n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=t[0],n[4]=t[1],n[5]=t[2],this._buffer2.update(),this._drawProgram.setAttributeArray("aCoord",this._buffer2,0,3,0),this._drawProgram.setUniformVector("uColor",this._api.color),this._drawProgram.setUniformMatrix("uMatrix",this._iMatrix),this._fboRight.bind(),this._drawProgram.setUniformMatrix("uPMatrix",this._pMatrixRight),this._drawProgram.setUniformMatrix("uMVMatrix",this._mvMatrixRight),this._drawProgram.drawArrays(s.MODE_LINES,0,2),this._fboStage.bind(),this._drawProgram.setUniformMatrix("uPMatrix",this._pMatrixStage),this._drawProgram.setUniformMatrix("uMVMatrix",this._mvMatrixStage),this._drawProgram.drawArrays(s.MODE_LINES,0,2),this._fboLeft.bind(),this._drawProgram.setUniformMatrix("uPMatrix",this._pMatrixLeft),this._drawProgram.setUniformMatrix("uMVMatrix",this._mvMatrixLeft),this._drawProgram.drawArrays(s.MODE_LINES,0,2),this._fboBack.bind(),this._drawProgram.setUniformMatrix("uPMatrix",this._pMatrixBack),this._drawProgram.setUniformMatrix("uMVMatrix",this._mvMatrixBack),this._drawProgram.drawArrays(s.MODE_LINES,0,2)},h.frame.nicofarre3d.prototype._drawPrimitive=function(e,t,n,r,i,o){var u=e.getTexture(),a=e.getDrawMode(),f=a==s.MODE_POINTS,l=u?this._textureProgram:f?this._pointProgram:this._drawProgram;l.setAttributeArray("aCoord",e.getVerticesBuffer(this._screen),0,3,0),u?(l.setAttributeArray("aTexCoord",e.getCoordsBuffer(this._screen),0,2,0),l.setTexture("uTexture",u)):f?l.setAttributeArray("aColor",e.getColorsBuffer(this._screen),0,4,0):l.setUniformVector("uColor",this._api.color),y.translate(this._iMatrix,i,this._matrix);if(o)if(typeof o[0]=="number")y.rotateX(this._matrix,o[0]),y.rotateY(this._matrix,o[1]),y.rotateZ(this._matrix,o[2]);else for(var c=o.length-1;c>=0;--c){var h=o[c];y.rotateX(this._matrix,h[0]),y.rotateY(this._matrix,h[1]),y.rotateZ(this._matrix,h[2])}y.scale(this._matrix,[t,n,r]),l.setUniformMatrix("uMatrix",this._matrix),this._fboRight.bind(),u&&l.setTexture("uTexture",u),l.setUniformMatrix("uPMatrix",this._pMatrixRight),l.setUniformMatrix("uMVMatrix",this._mvMatrixRight),l.drawElements(a,e.getIndicesBuffer(this._screen),0,e.items()),this._fboStage.bind(),u&&l.setTexture("uTexture",u),l.setUniformMatrix("uPMatrix",this._pMatrixStage),l.setUniformMatrix("uMVMatrix",this._mvMatrixStage),l.drawElements(a,e.getIndicesBuffer(this._screen),0,e.items()),this._fboLeft.bind(),u&&l.setTexture("uTexture",u),l.setUniformMatrix("uPMatrix",this._pMatrixLeft),l.setUniformMatrix("uMVMatrix",this._mvMatrixLeft),l.drawElements(a,e.getIndicesBuffer(this._screen),0,e.items()),this._fboBack.bind(),u&&l.setTexture("uTexture",u),l.setUniformMatrix("uPMatrix",this._pMatrixBack),l.setUniformMatrix("uMVMatrix",this._mvMatrixBack),l.drawElements(a,e.getIndicesBuffer(this._screen),0,e.items())},h.frame.nicofarre3d.prototype._fill=function(e){var t=e||this._api.color;this._drawProgram.setAttributeArray("aCoord",this._bufferICoord,0,3,0),this._drawProgram.setUniformVector("uColor",t),this._drawProgram.setUniformMatrix("uPMatrix",this._iMatrix),this._drawProgram.setUniformMatrix("uMVMatrix",this._iMatrix),this._drawProgram.setUniformMatrix("uMatrix",this._iMatrix),this._fboRight.bind(),this._drawProgram.drawArrays(s.MODE_TRIANGLE_FAN,0,4),this._fboStage.bind(),this._drawProgram.drawArrays(s.MODE_TRIANGLE_FAN,0,4),this._fboLeft.bind(),this._drawProgram.drawArrays(s.MODE_TRIANGLE_FAN,0,4),this._fboBack.bind(),this._drawProgram.drawArrays(s.MODE_TRIANGLE_FAN,0,4)},h.frame.nicofarre3d.prototype._createFont=function(e,t){var n={};for(var r=0;r<t.length;++r)n[t[r]]=this._screen.createStringTexture(t[r],e);return n},h.frame.signal=function(e){this._mv=e.mv,this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._color=e.color||[1,0,0,1],this._coord=e.coord||[0,0,.001],this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.signal._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.signal._fragmentShader)),this._coords=this._screen.createBuffer(this._coord)},h.frame.signal._vertexShader=null,h.frame.signal._fragmentShader=null,h.frame.signal.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","signal","shaders.html","vertex"),h.loadShader("frame","signal","shaders.html","fragment")]).then(function(t){h.frame.signal._vertexShader=t[0],h.frame.signal._fragmentShader=t[1],e()},function(e){n.log(e)})})},h.frame.signal.prototype.onresize=function(e){this._aspect=e},h.frame.signal.prototype.draw=function(e){this._screen.setAlphaMode(!0,this._screen.gl.ONE,this._screen.gl.ONE),this._program.setAttributeArray("aCoord",this._coords,0,3,0),this._program.setUniformVector("uColor",this._color),this._program.drawArrays(s.MODE_POINTS,0,1)},h.frame.signal.prototype.setController=function(e){this._controller=e},h.frame.signal.prototype.setColor=function(e){this._color=e},h.frame.effect=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller;var t=function(t,n){var r=n,i={};return typeof n!="string"&&(i=n.options||{},r=n.name),i.width=i.width||this._width,i.height=i.height||this._height,i.aspect=i.aspect||this._aspect,e.mv.create(t,r,i)}.bind(this),n;this._frames=[];for(n=0;n<e.frames.length;++n)this._frames[n]=t("frame",e.frames[n]);this._effects=[];for(n=0;n<e.effects.length;++n)this._effects[n]=t("effect",e.effects[n]);this._fbo=[];var r=this._screen;this._fbo[0]=r.createFrameBuffer(this._width,this._height),e.effects.length>1&&(this._fbo[1]=r.createFrameBuffer(this._width,this._height))},h.frame.effect.load=function(){return new Promise(function(e,t){e()})},h.frame.effect.prototype.onresize=function(e){this._aspect=e},h.frame.effect.prototype.draw=function(e){var t=this._fbo[0].bind();this._screen.pushAlphaMode(),this._screen.setAlphaMode(!1),this._screen.fillColor(0,0,0,1);var n;for(n=0;n<this._frames.length;++n)this._frames[n].draw(e);var r=this._effects.length-1;for(n=0;n<=r;++n)n==r?t.bind():this._fbo[(n+1)%2].bind(),this._screen.fillColor(0,0,0,1),this._effects[n].draw(e,this._fbo[n%2].texture);this._screen.popAlphaMode()},h.frame.effect.prototype.setController=function(e){this._controller=e},h.frame.effect.prototype.getFrame=function(e){return this._frames[e]},h.frame.at=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.at._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.at._fragmentShader)),this._sphere=o.createSphere(h.frame.at.resolution,o.SPHERE_METHOD_EVEN),this._vertices=this._screen.createBuffer(this._sphere.getVertices()),this._indices=this._screen.createElementBuffer(this._sphere.getIndices()),this._program.setAttributeArray("aVertexPosition",this._vertices,0,3,0),this._pMatrix=y.create(),this._mvMatrix=y.create(),this._rotate=[0,0,0],this._translate=[0,0,0],y.identity(this._mvMatrix);var t=function(){var e=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,0,0,0,0],[0,0,0,1,1,0,0,1,1,0,0,0],[0,0,0,1,1,0,0,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,1,0,0],[0,0,1,1,0,0,0,0,1,1,0,0],[0,0,1,1,0,0,0,0,1,1,0,0],[0,0,1,1,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],t=[],n=e.length,r=e[0].length;for(var i=0;i<n;++i)for(var s=0;s<r;++s){var o=e[i][s]==1?[.75,.01,0]:[.1,.1,.25];t.push([s-(r-1)/2,i-(n-1)/2,o[0]*512,o[1]*512,o[2]*512])}return t}(),n=function(){var e=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],t=[],n=e.length,r=e[0].length;for(var i=0;i<n;++i)for(var s=0;s<r;++s){var o=e[i][s]==1?[.75,.01,0]:[.1,.1,.25];t.push([s-(r-1)/2,i-(n-1)/2,o[0]*512,o[1]*512,o[2]*512])}return t}();this._logo=[],this._state=0;for(var r=0;r<t.length;++r)this._logo[r]={at:this,p:[n[r][0]*2,n[r][1]*-2,0,0],h:[n[r][0]*2,n[r][1]*-2,0,0],i:[n[r][0]*2,-7*Math.sin(n[r][1]/12*Math.PI*2),-7*Math.cos(n[r][1]/12*Math.PI*2),0],v:[0,0,0],a:[0,0,0],cr:[t[r][2]/512,t[r][3]/512,t[r][4]/512],ab:[n[r][2]/512,n[r][3]/512,n[r][4]/512],c:[t[r][2]/512,t[r][3]/512,t[r][4]/512],m:0,flip:!1,update:function(e){if(this.at._state==0)this.a=[(Math.random()-.5)*.5,(Math.random()-.5)*.5,(Math.random()-.5)*.5],this.v=[this.a[0]*-30,this.a[1]*-30,this.a[2]*-30],this.flip?(this.c[0]=this.ab[0],this.c[1]=this.ab[1],this.c[2]=this.ab[2]):(this.c[0]=this.cr[0],this.c[1]=this.cr[1],this.c[2]=this.cr[2]),this.flip=!this.flip;else if(this.at._state==1){var t=(this.p[0]-this.h[0])*this.v[0]<0;this.a=[this.a[0]*.98,this.a[1]*.98,this.a[2]*.98],this.v[0]+=this.a[0],this.v[1]+=this.a[1],this.v[2]+=this.a[2],this.p[0]+=this.v[0],this.p[1]+=this.v[1],this.p[2]+=this.v[2],t&&(this.p[0]-this.h[0])*this.v[0]>0&&(this.a=[0,0,0],this.v=[0,0,0],this.p[0]=this.h[0],this.p[1]=this.h[1],this.p[2]=this.h[2])}else this.at._state==5?(this.m+=.001*e,this.m>=1&&(this.m=1),this.p[0]=(1-this.m)*this.h[0]+this.m*this.i[0],this.p[1]=(1-this.m)*this.h[1]+this.m*this.i[1],this.p[2]=(1-this.m)*this.h[2]+this.m*this.i[2]):this.at._state==7&&(this.m-=.001*e,this.m<=0&&(this.m=0),this.p[0]=(1-this.m)*this.h[0]+this.m*this.i[0],this.p[1]=(1-this.m)*this.h[1]+this.m*this.i[1],this.p[2]=(1-this.m)*this.h[2]+this.m*this.i[2])}};this.onresize(this._aspect)},h.frame.at.resolution=3,h.frame.at._vertexShader=null,h.frame.at._fragmentShader=null,h.frame.at.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","at","shaders.html","vertex"),h.loadShader("frame","at","shaders.html","fragment")]).then(function(t){h.frame.at._vertexShader=t[0],h.frame.at._fragmentShader=t[1],e()},function(){t("at.load fails")})})},h.frame.at.prototype.onresize=function(e){this._aspect=e,y.perspective(45,e,.1,100,this._pMatrix),y.translate(this._pMatrix,[0,0,-70])},h.frame.at.prototype.draw=function(e){this._program.setAttributeArray("aVertexPosition",this._vertices,0,3,0),this._program.setUniformMatrix("uPMatrix",this._pMatrix);var t=g.create(),n=y.create(this._mvMatrix);y.translate(n,this._translate),y.rotate(n,this._rotate[0],[1,0,0]),y.rotate(n,this._rotate[1],[0,1,0]),y.rotate(n,this._rotate[2],[0,0,1]),this._screen.pushAlphaMode(),this._screen.setAlphaMode(!1);for(var r=0;r<this._logo.length;++r){this._logo[r].update(e);var i=y.create(n);y.translate(i,this._logo[r].p),this._program.setUniformMatrix("uMVMatrix",i);var t=g.create();y.toInverseMat3(i,t),g.transpose(t),this._program.setUniformMatrix("uNMatrix",t),this._program.setUniformVector("uColor",this._logo[r].c),this._program.drawElements(s.MODE_TRIANGLES,this._indices,0,this._sphere.items())}this._screen.popAlphaMode();if(this._state==0)this._rotate=[0,0,0],this._translate=[0,0,0],this._state=1;else if(this._state==1){for(r=0;r<this._logo.length;++r)if(this._logo[r].p[0]!=this._logo[r].h[0]||this._logo[r].p[1]!=this._logo[r].h[1]||this._logo[r].p[2]!=this._logo[r].h[2])return;this._state=2}else this._state==2?(this._rotate[0]+=.004*e,this._translate[2]+=.016*
e,this._rotate[0]>=Math.PI*3.5&&(this._rotate[0]=Math.PI*3.5,this._translate[2]=this._rotate[0]*4,this._state=3),this._translate[1]=Math.sin(this._rotate[0])*4):this._state==3?(this._rotate[2]+=.0015*e,this._translate[1]-=.0015*e,this._translate[2]+=.0015*e,this._rotate[2]>=Math.PI&&(this._rotate[2]=Math.PI,this._translate[1]=Math.sin(Math.PI*3.5)*4-this._rotate[2],this._translate[2]=Math.PI*15,this._state=4)):this._state==4?(this._rotate[2]+=.0015*e,this._translate[1]+=.0015*e,this._translate[2]-=.006*e,this._rotate[2]>=Math.PI*2&&(this._rotate[2]=Math.PI*2,this._translate[1]=Math.sin(Math.PI*3.5)*4,this._translate[2]=Math.PI*11,this._state=5)):this._state==5?(this._rotate[0]+=.0015*e,this._rotate[2]+=.0015*e,this._translate[1]+=.0015*e,this._translate[2]-=.006*e,this._rotate[0]>=Math.PI*4&&(this._rotate[0]=Math.PI*4,this._rotate[2]=Math.PI*2.5,this._translate[1]=Math.sin(Math.PI*3.5)*4+Math.PI*.5,this._translate[2]=Math.PI*9,this._state=6)):this._state==6?(this._rotate[0]+=.0015*e,this._rotate[2]+=.0015*e,this._rotate[2]>=Math.PI*3.5&&(this._rotate[0]=Math.PI*5,this._state=7)):this._state==7&&(this._rotate[0]+=.003*e,this._rotate[2]+=.0015*e,this._translate[1]+=.001*e,this._translate[2]-=.001*e,this._translate[1]>=0&&(this._translate[1]=0),this._translate[2]<=0&&(this._translate[2]=0),this._rotate[2]>=Math.PI*5&&(this._rotate[2]=Math.PI*5,this._state=0))},h.frame.at.prototype.setController=function(e){this._controller=e},h.frame.movie=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._video=null,this._texture=null,this._zoom=1,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.movie._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.movie._fragmentShader)),this._coords=this._screen.createBuffer([0,0,0,1,1,1,1,0]),e.url&&this.play(e.url)},h.frame.movie._vertexShader=null,h.frame.movie._fragmentShader=null,h.frame.movie.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","movie","shaders.html","vertex"),h.loadShader("frame","movie","shaders.html","fragment")]).then(function(t){h.frame.movie._vertexShader=t[0],h.frame.movie._fragmentShader=t[1],e()},function(e){n.log(e)})})},h.frame.movie.prototype.play=function(e){return new Promise(function(t,r){h.loadMovieFrom(e).then(function(e){this._video=e,n.log("video: "+e.videoWidth+"x"+e.videoHeight);var r=e.videoWidth/e.videoHeight;this._aspect>r&&(this._zoom=this._aspect/r),this._texture=this._screen.createTexture(e,!0,s.FILTER_LINEAR),e.play(),e.addEventListener("ended",function(){e.currentTime=0,e.play()}),t()}.bind(this),function(e){n.log(e)})}.bind(this))},h.frame.movie.prototype.onresize=function(e){this._aspect=e},h.frame.movie.prototype.draw=function(e){if(!this._texture)return;this._texture.update(this._video),this._program.setAttributeArray("aCoord",this._coords,0,2,0),this._program.setUniformVector("uZoom",[this._zoom]),this._program.setTexture("uTexture",this._texture),this._program.drawArrays(s.MODE_TRIANGLE_FAN,0,4)},h.frame.movie.prototype.setController=function(e){this._controller=e},h.frame.nico_test=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._speed=4,this._x=0,this._y=0,this._z=0,this._ax=this._speed,this._ay=this._speed,this._az=this._speed,this._t=0,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.nico_test._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.nico_test._fragmentShader)),this._coords=this._screen.createBuffer([40/1920*2-1,760/1080*2-1,40/1920*2-1,1040/1080*2-1,1520/1920*2-1,1040/1080*2-1,1520/1920*2-1,760/1080*2-1,40/1920*2-1,120/1080*2-1,40/1920*2-1,400/1080*2-1,880/1920*2-1,400/1080*2-1,880/1920*2-1,120/1080*2-1,40/1920*2-1,440/1080*2-1,40/1920*2-1,720/1080*2-1,1520/1920*2-1,720/1080*2-1,1520/1920*2-1,440/1080*2-1,920/1920*2-1,120/1080*2-1,920/1920*2-1,400/1080*2-1,1760/1920*2-1,400/1080*2-1,1760/1920*2-1,120/1080*2-1,.625,760/1080*2-1,.625,1040/1080*2-1,1720/1920*2-1,1040/1080*2-1,1720/1920*2-1,760/1080*2-1,.625,440/1080*2-1,.625,720/1080*2-1,1720/1920*2-1,720/1080*2-1,1720/1920*2-1,440/1080*2-1,1760/1920*2-1,870/1080*2-1,1760/1920*2-1,1040/1080*2-1,1858/1920*2-1,1040/1080*2-1,1858/1920*2-1,870/1080*2-1]),this._texCoods=this._screen.createBuffer([880,20,40,880,300,40,880,300,1520,880,20,1520,20,20,0,20,300,0,860,300,0,860,20,0,0,20,1520,0,300,1520,0,300,40,0,20,40,860,20,1560,860,300,1560,20,300,1560,20,20,1560,700,20,200,700,300,200,860,300,200,860,20,200,20,20,200,20,300,200,180,300,200,180,20,200,20,320,40,20,320,1520,860,320,1520,860,320,40])},h.frame.nico_test._vertexShader=null,h.frame.nico_test._fragmentShader=null,h.frame.nico_test.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","nico_test","shaders.html","vertex"),h.loadShader("frame","nico_test","shaders.html","fragment")]).then(function(t){h.frame.nico_test._vertexShader=t[0],h.frame.nico_test._fragmentShader=t[1],e()},function(){t("nico_test.load fails")})})},h.frame.nico_test.prototype.onresize=function(e){this._aspect=e},h.frame.nico_test.prototype.draw=function(e){this._x+=this._ax,this._x<0?this._ax=this._speed:this._x>880&&(this._ax=-this._speed),this._y+=this._ay,this._y<0?this._ay=this._speed:this._y>320&&(this._ay=-this._speed),this._controller&&this._controller.volume&&this._controller.volume[2]&&(this._az=0,this._z+=this._controller.volume[2],uma.log(this._z)),this._z+=this._az,this._z<0?this._az=this._speed:this._z>1480&&(this._az=-this._speed),this._t+=e,this._screen.pushAlphaMode(),this._screen.setAlphaMode(!0,this._screen.gl.SRC_ALPHA,this._screen.gl.ONE),this._screen.fillColor(0,0,0,1),this._program.setAttributeArray("aCoord",this._coords,0,2,0),this._program.setAttributeArray("aTexCoord",this._texCoods,0,3,0),this._program.setUniformVector("uX",[this._x]),this._program.setUniformVector("uY",[this._y]),this._program.setUniformVector("uZ",[this._z]);var t=[Math.sin(this._t/300)/20,Math.sin(this._t/500)/30,Math.sin(this._t/700)/40+.1];this._program.setUniformVector("uT",t),this._program.drawArrays(s.MODE_TRIANGLE_FAN,0,4),this._program.drawArrays(s.MODE_TRIANGLE_FAN,4,4),this._program.drawArrays(s.MODE_TRIANGLE_FAN,8,4),this._program.drawArrays(s.MODE_TRIANGLE_FAN,12,4),this._program.drawArrays(s.MODE_TRIANGLE_FAN,16,4),this._program.drawArrays(s.MODE_TRIANGLE_FAN,20,4),this._program.drawArrays(s.MODE_TRIANGLE_FAN,24,4),this._screen.popAlphaMode()},h.frame.nico_test.prototype.setController=function(e){this._controller=e},h.frame.ab2=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.ab2._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.ab2._fragmentShader)),this._sphere=o.createSphere(h.frame.ab2.resolution,o.SPHERE_METHOD_EVEN),this._vertices=this._screen.createBuffer(this._sphere.getVertices()),this._indices=this._screen.createElementBuffer(this._sphere.getIndices()),this._program.setAttributeArray("aVertexPosition",this._vertices,0,3,0),this._pMatrix=y.create(),this._mvMatrix=y.create(),this._rotate=[0,0,0],this._translate=[0,0,0],y.identity(this._mvMatrix);var t=[[-5,-5,255,255,255,255],[-4,-5,255,255,255,255],[-3,-5,255,255,255,255],[-2,-5,255,255,255,255],[-1,-5,255,255,255,255],[0,-5,255,255,255,255],[1,-5,255,255,255,255],[2,-5,255,255,255,255],[3,-5,255,255,255,255],[4,-5,255,255,255,255],[5,-5,255,255,255,255],[6,-5,255,255,255,255],[-5,-4,255,255,255,255],[-4,-4,255,255,255,255],[-3,-4,255,255,255,255],[-2,-4,255,255,255,255],[-1,-4,243,117,95,255],[0,-4,244,128,105,255],[1,-4,244,123,102,255],[2,-4,242,107,88,255],[3,-4,255,255,253,255],[4,-4,255,255,255,255],[5,-4,255,255,255,255],[6,-4,255,255,255,255],[-5,-3,255,255,255,255],[-4,-3,255,255,255,255],[-3,-3,237,239,238,255],[-2,-3,238,86,72,255],[-1,-3,238,95,79,255],[0,-3,240,99,82,255],[1,-3,239,98,81,255],[2,-3,240,90,75,255],[3,-3,235,77,65,255],[4,-3,238,237,243,255],[5,-3,255,255,255,255],[6,-3,255,255,255,255],[-5,-2,255,255,255,255],[-4,-2,254,254,254,255],[-3,-2,233,59,52,255],[-2,-2,233,64,57,255],[-1,-2,233,70,61,255],[0,-2,235,72,63,255],[1,-2,234,70,61,255],[2,-2,234,65,58,255],[3,-2,232,59,53,255],[4,-2,232,58,51,255],[5,-2,253,255,252,255],[6,-2,255,255,255,255],[-5,-1,255,255,255,255],[-4,-1,87,191,92,255],[-3,-1,92,193,91,255],[-2,-1,232,58,51,255],[-1,-1,241,249,251,255],[0,-1,131,182,225,255],[1,-1,132,183,226,255],[2,-1,244,254,255,255],[3,-1,253,217,1,255],[4,-1,253,217,1,255],[5,-1,251,215,5,255],[6,-1,255,255,255,255],[-5,0,255,255,255,255],[-4,0,89,191,91,255],[-3,0,91,193,91,255],[-2,0,209,45,36,255],[-1,0,87,156,211,255],[0,0,103,163,213,255],[1,0,105,165,215,255],[2,0,88,157,212,255],[3,0,253,217,1,255],[4,0,253,217,1,255],[5,0,250,213,0,255],[6,0,255,255,255,255],[-5,1,255,255,255,255],[-4,1,89,186,91,255],[-3,1,91,193,91,255],[-2,1,91,193,91,255],[-1,1,59,141,197,255],[0,1,67,148,204,255],[1,1,67,147,206,255],[2,1,60,142,200,255],[3,1,253,217,1,255],[4,1,253,217,1,255],[5,1,249,211,16,255],[6,1,255,255,255,255],[-5,2,255,255,255,255],[-4,2,89,175,88,255],[-3,2,90,192,92,255],[-2,2,91,193,91,255],[-1,2,213,226,217,255],[0,2,39,118,175,255],[1,2,39,122,176,255],[2,2,204,229,207,255],[3,2,253,217,1,255],[4,2,252,215,4,255],[5,2,243,198,34,255],[6,2,255,255,255,255],[-5,3,255,255,255,255],[-4,3,252,252,252,255],[-3,3,86,179,88,255],[-2,3,90,192,92,255],[-1,3,91,193,91,255],[0,3,91,193,91,255],[1,3,84,181,86,255],[2,3,252,217,1,255],[3,3,250,215,0,255],[4,3,244,203,27,255],[5,3,251,251,251,255],[6,3,255,255,255,255],[-5,4,255,255,255,255],[-4,4,255,255,255,255],[-3,4,223,223,223,255],[-2,4,85,175,87,255],[-1,4,89,184,90,255],[0,4,88,188,90,255],[1,4,249,211,12,255],[2,4,247,207,21,255],[3,4,239,195,36,255],[4,4,223,225,222,255],[5,4,255,255,255,255],[6,4,255,255,255,255],[-5,5,255,255,255,255],[-4,5,255,255,255,255],[-3,5,255,255,255,255],[-2,5,250,250,250,255],[-1,5,68,149,82,255],[0,5,72,158,87,255],[1,5,228,179,50,255],[2,5,220,169,52,255],[3,5,249,249,249,255],[4,5,255,255,255,255],[5,5,255,255,255,255],[6,5,255,255,255,255]],n=function(){var e=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,1,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,1,0,0,0,0],[0,0,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],t=[],n=e.length,r=e[0].length;for(var i=0;i<n;++i)for(var s=0;s<r;++s){var o=e[i][s]==1?[.75,.01,0]:[.1,.1,.25];t.push([s-(r-1)/2,i-(n-1)/2,o[0]*512,o[1]*512,o[2]*512])}return t}();this._logo=[],this._state=0;for(var r=0;r<t.length;++r)this._logo[r]={ab2:this,p:[n[r][0]*2,n[r][1]*-2,0,0],h:[n[r][0]*2,n[r][1]*-2,0,0],i:[n[r][0]*2,-7*Math.sin(n[r][1]/12*Math.PI*2),-7*Math.cos(n[r][1]/12*Math.PI*2),0],v:[0,0,0],a:[0,0,0],cr:[t[r][2]/512,t[r][3]/512,t[r][4]/512],ab:[n[r][2]/512,n[r][3]/512,n[r][4]/512],c:[t[r][2]/512,t[r][3]/512,t[r][4]/512],m:0,flip:!1,update:function(e){if(this.ab2._state==0)this.a=[(Math.random()-.5)*.5,(Math.random()-.5)*.5,(Math.random()-.5)*.5],this.v=[this.a[0]*-30,this.a[1]*-30,this.a[2]*-30],this.flip?(this.c[0]=this.ab[0],this.c[1]=this.ab[1],this.c[2]=this.ab[2]):(this.c[0]=this.cr[0],this.c[1]=this.cr[1],this.c[2]=this.cr[2]),this.flip=!this.flip;else if(this.ab2._state==1){var t=(this.p[0]-this.h[0])*this.v[0]<0;this.a=[this.a[0]*.98,this.a[1]*.98,this.a[2]*.98],this.v[0]+=this.a[0],this.v[1]+=this.a[1],this.v[2]+=this.a[2],this.p[0]+=this.v[0],this.p[1]+=this.v[1],this.p[2]+=this.v[2],t&&(this.p[0]-this.h[0])*this.v[0]>0&&(this.a=[0,0,0],this.v=[0,0,0],this.p[0]=this.h[0],this.p[1]=this.h[1],this.p[2]=this.h[2])}else this.ab2._state==5?(this.m+=.001*e,this.m>=1&&(this.m=1),this.p[0]=(1-this.m)*this.h[0]+this.m*this.i[0],this.p[1]=(1-this.m)*this.h[1]+this.m*this.i[1],this.p[2]=(1-this.m)*this.h[2]+this.m*this.i[2]):this.ab2._state==7&&(this.m-=.001*e,this.m<=0&&(this.m=0),this.p[0]=(1-this.m)*this.h[0]+this.m*this.i[0],this.p[1]=(1-this.m)*this.h[1]+this.m*this.i[1],this.p[2]=(1-this.m)*this.h[2]+this.m*this.i[2])}};this.onresize(this._aspect)},h.frame.ab2.resolution=3,h.frame.ab2._vertexShader=null,h.frame.ab2._fragmentShader=null,h.frame.ab2.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","ab2","shaders.html","vertex"),h.loadShader("frame","ab2","shaders.html","fragment")]).then(function(t){h.frame.ab2._vertexShader=t[0],h.frame.ab2._fragmentShader=t[1],e()},function(){t("ab2.load fails")})})},h.frame.ab2.prototype.onresize=function(e){this._aspect=e,y.perspective(45,e,.1,100,this._pMatrix),y.translate(this._pMatrix,[0,0,-70])},h.frame.ab2.prototype.draw=function(e){this._program.setAttributeArray("aVertexPosition",this._vertices,0,3,0),this._program.setUniformMatrix("uPMatrix",this._pMatrix);var t=g.create(),n=y.create(this._mvMatrix);y.translate(n,this._translate),y.rotate(n,this._rotate[0],[1,0,0]),y.rotate(n,this._rotate[1],[0,1,0]),y.rotate(n,this._rotate[2],[0,0,1]),this._screen.pushAlphaMode(),this._screen.setAlphaMode(!1);for(var r=0;r<this._logo.length;++r){this._logo[r].update(e);var i=y.create(n);y.translate(i,this._logo[r].p),this._program.setUniformMatrix("uMVMatrix",i);var t=g.create();y.toInverseMat3(i,t),g.transpose(t),this._program.setUniformMatrix("uNMatrix",t),this._program.setUniformVector("uColor",this._logo[r].c),this._program.drawElements(s.MODE_TRIANGLES,this._indices,0,this._sphere.items())}this._screen.popAlphaMode();if(this._state==0)this._rotate=[0,0,0],this._translate=[0,0,0],this._state=1;else if(this._state==1){for(r=0;r<this._logo.length;++r)if(this._logo[r].p[0]!=this._logo[r].h[0]||this._logo[r].p[1]!=this._logo[r].h[1]||this._logo[r].p[2]!=this._logo[r].h[2])return;this._state=2}else this._state==2?(this._rotate[0]+=.004*e,this._translate[2]+=.016*e,this._rotate[0]>=Math.PI*3.5&&(this._rotate[0]=Math.PI*3.5,this._translate[2]=this._rotate[0]*4,this._state=3),this._translate[1]=Math.sin(this._rotate[0])*4):this._state==3?(this._rotate[2]+=.0015*e,this._translate[1]-=.0015*e,this._translate[2]+=.0015*e,this._rotate[2]>=Math.PI&&(this._rotate[2]=Math.PI,this._translate[1]=Math.sin(Math.PI*3.5)*4-this._rotate[2],this._translate[2]=Math.PI*15,this._state=4)):this._state==4?(this._rotate[2]+=.0015*e,this._translate[1]+=.0015*e,this._translate[2]-=.006*e,this._rotate[2]>=Math.PI*2&&(this._rotate[2]=Math.PI*2,this._translate[1]=Math.sin(Math.PI*3.5)*4,this._translate[2]=Math.PI*11,this._state=5)):this._state==5?(this._rotate[0]+=.0015*e,this._rotate[2]+=.0015*e,this._translate[1]+=.0015*e,this._translate[2]-=.006*e,this._rotate[0]>=Math.PI*4&&(this._rotate[0]=Math.PI*4,this._rotate[2]=Math.PI*2.5,this._translate[1]=Math.sin(Math.PI*3.5)*4+Math.PI*.5,this._translate[2]=Math.PI*9,this._state=6)):this._state==6?(this._rotate[0]+=.0015*e,this._rotate[2]+=.0015*e,this._rotate[2]>=Math.PI*3.5&&(this._rotate[0]=Math.PI*5,this._state=7)):this._state==7&&(this._rotate[0]+=.003*e,this._rotate[2]+=.0015*e,this._translate[1]+=.001*e,this._translate[2]-=.001*e,this._translate[1]>=0&&(this._translate[1]=0),this._translate[2]<=0&&(this._translate[2]=0),this._rotate[2]>=Math.PI*5&&(this._rotate[2]=Math.PI*5,this._state=0))},h.frame.ab2.prototype.setController=function(e){this._controller=e},h.frame.filter=function(e){this._mv=e.mv,this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._color=e.color||[0,0,0,1],this._zoom=typeof e.zoom!="undefined"?e.zoom:1,this._fade=typeof e.fade!="undefined"?e.fade:1,this._offset=e.offset||[0,0],this._texture=null,this._colorProgram=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.filter._vColorShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.filter._fColorShader)),this._textureProgram=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.filter._vTextureShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.filter._fTextureShader)),this._coords=null,this._texCoords=this._screen.createBuffer([0,0,0,1,1,1,1,0]),this._blend_src=this._screen.gl.ZERO,this._blend_dst=this._screen.gl.ZERO,this._setFilterType(e.filter),e.texture?this.setTexture(e.texture):this._coords=this._screen.createBuffer([-1,-1,-1,1,1,1,1,-1])},h.frame.filter.REVERSE=0,h.frame.filter.SRC=1,h.frame.filter.ALPHA=2,h.frame.filter.ADD=3,h.frame.filter.MUL=4,h.frame.filter._vColorShader=null,h.frame.filter._fColorShader=null,h.frame.filter._vTextureShader=null,h.frame.filter._fTextureShader=null,h.frame.filter.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","filter","shaders.html","vColor"),h.loadShader("frame","filter","shaders.html","fColor"),h.loadShader("frame","filter","shaders.html","vTexture"),h.loadShader("frame","filter","shaders.html","fTexture")]).then(function(t){h.frame.filter._vColorShader=t[0],h.frame.filter._fColorShader=t[1],h.frame.filter._vTextureShader=t[2],h.frame.filter._fTextureShader=t[3],e()},function(e){n.log(e)})})},h.frame.filter.prototype.onresize=function(e){this._aspect=e},h.frame.filter.prototype.draw=function(e){this._screen.setAlphaMode(!0,this._blend_src,this._blend_dst),this._texture?(this._textureProgram.setAttributeArray("aCoord",this._coords,0,2,0),this._textureProgram.setAttributeArray("aTexCoord",this._texCoords,0,2,0),this._textureProgram.setTexture("uTexture",this._texture),this._textureProgram.setUniformVector("uFade",[this._fade]),this._textureProgram.drawArrays(s.MODE_TRIANGLE_FAN,0,4)):this._coords&&(this._colorProgram.setAttributeArray("aCoord",this._coords,0,2,0),this._colorProgram.setUniformVector("uColor",this._color),this._colorProgram.drawArrays(s.MODE_TRIANGLE_FAN,0,4))},h.frame.filter.prototype.setController=function(e){this._controller=e},h.frame.filter.prototype.setColor=function(e){this._color=e},h.frame.filter.prototype.setTexture=function(e){typeof e=="object"&&e.constructor.name==="HTMLImageElement"?(this._texture=this._screen.createTexture(e,!0,s.FILTER_LINEAR),this._resetCoords()):h.loadImageFrom(e).then(function(e){this._texture=this._screen.createTexture(e,!0,s.FILTER_LINEAR),this._resetCoords()}.bind(this),function(e){n.log(e)})},h.frame.filter.prototype.setZoom=function(e){this._zoom=e,this._resetCoords()},h.frame.filter.prototype.setOffset=function(e){this._offset=e,this._resetCoords()},h.frame.filter.prototype.setFade=function(e){this._fade=e},h.frame.filter.prototype._resetCoords=function(){if(!this._texture)return;var e=this._texture.width/this._texture.height,t=this._zoom,n=this._zoom;this._aspect>e?t*=e/this._aspect:n*=this._aspect/e;var r=this._offset[0]*this._zoom,i=this._offset[1]*this._zoom,s=[-t+r,-n+i,-t+r,n+i,t+r,n+i,t+r,-n+i];if(!this._coords)this._coords=this._screen.createBuffer(s);else{var o=this._coords.buffer();for(var u=0;u<s.length;++u)o[u]=s[u];this._coords.update()}},h.frame.filter.prototype._setFilterType=function(e){e||(e=h.frame.filter.REVERSE);var t=this._screen.gl;switch(e){case h.frame.filter.REVERSE:this._blend_src=t.ZERO,this._blend_dst=t.ONE_MINUS_DST_COLOR;break;case h.frame.filter.SRC:this._blend_src=t.ONE,this._blend_dst=t.ZERO;break;case h.frame.filter.ALPHA:this._blend_src=t.SRC_ALPHA,this._blend_dst=t.ONE_MINUS_SRC_ALPHA;break;case h.frame.filter.ADD:this._blend_src=t.ONE,this._blend_dst=t.ONE;break;case h.frame.filter.MUL:this._blend_src=t.DST_COLOR,this._blend_dst=t.ZERO}},h.frame.wired=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._rotate=0,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.wired._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.wired._fragmentShader)),this._lines=this._screen.createBuffer(function(){var e=0,t=new Array;for(var n=-900;n<=900;n+=100){for(var r=-900;r<=900;r+=100)t[e+0]=r,t[e+1]=-900,t[e+2]=n,t[e+3]=r,t[e+4]=900,t[e+5]=n,e+=6;for(var i=-900;i<=900;i+=100)t[e+0]=-900,t[e+1]=i,t[e+2]=n,t[e+3]=900,t[e+4]=i,t[e+5]=n,e+=6}for(var r=-900;r<=900;r+=100)for(var i=-900;i<=900;i+=100)t[e+0]=r,t[e+1]=i,t[e+2]=-900,t[e+3]=r,t[e+4]=i,t[e+5]=900,e+=6;return t}()),this._lines.items=1944,this._pMatrix=y.create(),this.onresize(this._aspect)},h.frame.wired._vertexShader=null,h.frame.wired._fragmentShader=null,h.frame.wired.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","wired","shaders.html","vertex"),h.loadShader("frame","wired","shaders.html","fragment")]).then(function(t){h.frame.wired._vertexShader=t[0],h.frame.wired._fragmentShader=t[1],e()},function(){t("wired.load fails")})})},h.frame.wired.prototype.onresize=function(e){this._aspect=e,y.perspective(45,e,.1,1e3,this._pMatrix),y.translate(this._pMatrix,[0,0,-250]),y.rotate(this._pMatrix,this._rotate,[.1,.2,0])},h.frame.wired.prototype.draw=function(e){var t=.002*e;this._controller&&this._controller.slider&&(t*=.5+this._controller.slider*1.5),this._rotate+=t,y.rotate(this._pMatrix,t,[.1,.2,0]),this._program.setUniformMatrix("uPMatrix",this._pMatrix),this._program.setAttributeArray("aVertexPosition",this._lines,0,3,0),this._program.drawArrays(s.MODE_LINES,0,this._lines.items)},h.frame.wired.prototype.setController=function(e){this._controller=e},h.frame.specticle=function(e){this._mv=e.mv,this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._color=e.color||[.7,.2,.5,1],this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.specticle._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.specticle._fragmentShader)),this._matrix=y.identity(),this.onresize(this._aspect),this._t=0,this._n=500,this._coords=this._screen.createBuffer(new Array(this._n*3)),this._dh=new Array(this._n),this._dv=new Array(this._n),this._r=new Array(this._n),this._sv=new Array(this._n),this._sh=new Array(this._n);var t=e.random||1;for(var n=0;n<this._n;++n)this._dh[n]=Math.random()*Math.PI*2,this._dv[n]=Math.random()*Math.PI*2,this._r[n]=Math.random()*t*6+(3-t),this._sv[n]=Math.random()*10+10,this._sh[n]=Math.random()*20+20},h.frame.specticle._vertexShader=null,h.frame.specticle._fragmentShader=null,h.frame.specticle.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","specticle","shaders.html","vertex"),h.loadShader("frame","specticle","shaders.html","fragment")]).then(function(t){h.frame.specticle._vertexShader=t[0],h.frame.specticle._fragmentShader=t[1],e()},function(e){n.log(e)})})},h.frame.specticle.prototype.onresize=function(e){this._aspect=e,y.perspective(45,e,.1,100,this._matrix)},h.frame.specticle.prototype.draw=function(e){this._t+=e;var t=this._t/1e4,n=this._coords.buffer(),r=this._controller&&this._controller.sound&&this._controller.sound.fftDb&&this._controller.sound.fftDb.length,i=!r||this._controller.sound.fftDb.length-128;for(var o=0;o<this._n;++o){var u=Math.sin(t*this._sv[o]+this._dv[o])*10,a=1;if(r){var f=0|i*(u+10)/20,l=80+this._controller.sound.fftDb[128+f];l<0&&(l=0),a=l/20}n[o*3+0]=Math.cos(t*this._sh[o]+this._dh[o])*this._r[o]*a,n[o*3+1]=u,n[o*3+2]=Math.sin(t*this._sh[o]+this._dh[o])*this._r[o]*a-40}this._coords.update(),this._screen.setAlphaMode(!0,this._screen.gl.ONE,this._screen.gl.ONE),this._program.setAttributeArray("aCoord",this._coords,0,3,0),this._program.setUniformMatrix("uMatrix",this._matrix),this._program.setUniformVector("uColor",this._color),this._program.drawArrays(s.MODE_POINTS,0,this._n)},h.frame.specticle.prototype.setController=function(e){this._controller=e},h.frame.morphere=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.morphere._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.morphere._fragmentShader)),this._sphere=o.createSphere(h.frame.morphere.resolution,o.SPHERE_METHOD_EVEN),this._sphere.scale(10),this._pMatrix=y.identity(),this._color=[.1,.1,.4],this._vertices=this._sphere.getVertices().length,this._b=new Array(this._vertices),this._v=new Array(this._vertices),this._r=new Array(this._vertices),this._t=new Array(this._vertices);for(var t=0;t<this._vertices;++t)this._b[t]=this._sphere.getVertices()[t],this._v[t]=Math.random(),this._r[t]=Math.random()*5,this._t[t]=Math.random()*Math.PI*2;this.onresize(this._aspect)},h.frame.morphere.resolution=4,h.frame.morphere._vertexShader=null,h.frame.morphere._fragmentShader=null,h.frame.morphere.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","morphere","shaders.html","vertex"),h.loadShader("frame","morphere","shaders.html","fragment")]).then(function(t){h.frame.morphere._vertexShader=t[0],h.frame.morphere._fragmentShader=t[1],e()},function(){t("morphere.load fails")})})},h.frame.morphere.prototype.onresize=function(e){this._aspect=e,y.perspective(45,e,.1,100,this._pMatrix),y.translate(this._pMatrix,[0,0,-70])},h.frame.morphere.prototype.draw=function(e){var t=this._sphere.getVerticesBuffer(this._screen),n=t.buffer(),r=Math.sin,i=e/100;for(var o=0;o<this._vertices;++o)this._t[o]+=this._v[o]*i,n[o]=this._b[o]+r(this._t[o])*this._r[o];t.update();var u=2;this._controller&&this._controller.volume&&this._controller.volume[0]&&(u*=this._controller.volume[0]),this._screen.pushAlphaMode(),this._screen.setAlphaMode(!1);var a=y.create();y.scale(this._pMatrix,[u,u,u],a),this._program.setAttributeArray("aVertexPosition",t,0,3,0),this._program.setUniformMatrix("uPMatrix",a),this._program.setUniformVector("uColor",this._color),this._program.drawElements(s.MODE_TRIANGLES,this._sphere.getIndicesBuffer(this._screen),0,this._sphere.items()),this._screen.popAlphaMode()},h.frame.morphere.prototype.setController=function(e){this._controller=e},h.frame.nicofarre=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.nicofarre._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.nicofarre._fragmentShader)),this._coords=this._screen.createBuffer([40/1920*2-1,760/1080*2-1,40/1920*2-1,1040/1080*2-1,1520/1920*2-1,1040/1080*2-1,1520/1920*2-1,760/1080*2-1,40/1920*2-1,120/1080*2-1,40/1920*2-1,400/1080*2-1,880/1920*2-1,400/1080*2-1,880/1920*2-1,120/1080*2-1,40/1920*2-1,440/1080*2-1,40/1920*2-1,720/1080*2-1,1520/1920*2-1,720/1080*2-1,1520/1920*2-1,440/1080*2-1,920/1920*2-1,120/1080*2-1,920/1920*2-1,400/1080*2-1,1760/1920*2-1,400/1080*2-1,1760/1920*2-1,120/1080*2-1,.625,760/1080*2-1,.625,1040/1080*2-1,1720/1920*2-1,1040/1080*2-1,1720/1920*2-1,760/1080*2-1,.625,440/1080*2-1,.625,720/1080*2-1,1720/1920*2-1,720/1080*2-1,1720/1920*2-1,440/1080*2-1,1760/1920*2-1,870/1080*2-1,1760/1920*2-1,1040/1080*2-1,1858/1920*2-1,1040/1080*2-1,1858/1920*2-1,870/1080*2-1,40/1920*2-1,440/1080*2-1,40/1920*2-1,720/1080*2-1,1520/1920*2-1,720/1080*2-1,1520/1920*2-1,440/1080*2-1,40/1920*2-1,120/1080*2-1,40/1920*2-1,400/1080*2-1,880/1920*2-1,400/1080*2-1,880/1920*2-1,120/1080*2-1,40/1920*2-1,760/1080*2-1,40/1920*2-1,1040/1080*2-1,1520/1920*2-1,1040/1080*2-1,1520/1920*2-1,760/1080*2-1,920/1920*2-1,120/1080*2-1,920/1920*2-1,400/1080*2-1,1760/1920*2-1,400/1080*2-1,1760/1920*2-1,120/1080*2-1,40/1920*2-1,440/1080*2-1,40/1920*2-1,720/1080*2-1,1520/1920*2-1,720/1080*2-1,1520/1920*2-1,440/1080*2-1,40/1920*2-1,120/1080*2-1,40/1920*2-1,400/1080*2-1,880/1920*2-1,400/1080*2-1,880/1920*2-1,120/1080*2-1,40/1920*2-1,760/1080*2-1,40/1920*2-1,1040/1080*2-1,1520/1920*2-1,1040/1080*2-1,1520/1920*2-1,760/1080*2-1]),this._texCoods=this._screen.createBuffer([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1480/3800,1,1480/3800,0,1480/3800,0,1480/3800,1,2320/3800,1,2320/3800,0,2320/3800,0,2320/3800,1,1,1,1,0,4220/4640,0,4220/4640,1,5060/4640,1,5060/4640,0,420/4640,0,420/4640,1,1900/4640,1,1900/4640,0,1900/4640,0,1900/4640,1,2740/4640,1,2740/4640,0,2740/4640,0,2740/4640,1,4220/4640,1,4220/4640,0]);var t=[[1480,280],[840,280],[1480,280],[840,280],[160,280],[160,280],[98,170],[3800,280],[],[],[4640,280],[],[],[]];this._led=e.led,this._mirror=e.mirror,this._mirror===undefined&&(this._mirror=h.frame.nicofarre.MIRROR_OFF);var n=t[this._led[0]][0]*this._width/1920,r=t[this._led[0]][1]*this._height/1080;this._fbo=this._screen.createFrameBuffer(n,r),this._frames=[];for(var i=0;i<e.frames.length;++i){var o=e.frames[i],u={};typeof o!="string"&&(u=o.options||{},o=o.name),u.width=u.width||n,u.height=u.height||r,u.aspect=u.aspect||n/r,this._frames[i]=e.mv.create("frame",o,u)}},h.frame.nicofarre.LED_A=[0],h.frame.nicofarre.LED_B=[1],h.frame.nicofarre.LED_C=[2],h.frame.nicofarre.LED_D=[3],h.frame.nicofarre.LED_E=[4],h.frame.nicofarre.LED_F=[5],h.frame.nicofarre.LED_G=[6],h.frame.nicofarre.LED_WALL_RIGHT=[0],h.frame.nicofarre.LED_STAGE=[1],h.frame.nicofarre.LED_WALL_LEFT=[2],h.frame.nicofarre.LED_BACK=[3],h.frame.nicofarre.LED_FRONT_RIGHT=[4],h.frame.nicofarre.LED_FRONT_LEFT=[5],h.frame.nicofarre.LED_CEILING=[6],h.frame.nicofarre.LED_FRONT_BOTH=[4,5],h.frame.nicofarre.LED_WALL_BOTH=[0,2],h.frame.nicofarre.LED_STAGE_AND_BACK=[1,3],h.frame.nicofarre.LED_LEFT_STAGE_RIGHT=[7,8,9],h.frame.nicofarre.LED_WHOLE_WALLS=[10,11,12,13],h.frame.nicofarre.MIRROR_OFF=-1,h.frame.nicofarre.MIRROR_ON_RIGHT=0,h.frame.nicofarre.MIRROR_ON_LEFT=1,h.frame.nicofarre._vertexShader=null,h.frame.nicofarre._fragmentShader=null,h.frame.nicofarre.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","nicofarre","shaders.html","vertex"),h.loadShader("frame","nicofarre","shaders.html","fragment")]).then(function(t){h.frame.nicofarre._vertexShader=t[0],h.frame.nicofarre._fragmentShader=t[1],e()},function(){t("nicofarre.load fails")})})},h.frame.nicofarre.prototype.onresize=function(e){this._aspect=e},h.frame.nicofarre.prototype.draw=function(e){var t=this._fbo.bind(),n;this._screen.pushAlphaMode(),this._screen.setAlphaMode(!0,this._screen.gl.ONE,this._screen.gl.ONE),this._screen.fillColor(0,0,0,1);for(n=0;n<this._frames.length;++n)this._frames[n].draw(e);this._screen.popAlphaMode(),t.bind(),this._program.setAttributeArray("aCoord",this._coords,0,2,0),this._program.setAttributeArray("aTexCoord",this._texCoods,0,2,0),this._program.setTexture("uTexture",this._fbo.texture);for(n=0;n<this._led.length;++n){var r=this._led[n]*4,i=n==this._mirror?1:0;this._program.setUniformVector("uMirror",[i]),this._program.drawArrays(s.MODE_TRIANGLE_FAN,r,4)}},h.frame.nicofarre.prototype.setController=function(e){this._controller=e},h.frame.nicofarre.prototype.getFrame=function(e){return this._frames[e]},h.frame.snow=function(e){this._screen=e.screen,this._width=e.width,this._height=e.height,this._aspect=e.aspect,this._controller=e.controller,this._ps=new u.Container(h.frame.snow.ps),this._coords=this._screen.createBuffer([0,0,0,1,1,1,1,0]),this._program=this._screen.createProgram(this._screen.compileShader(s.VERTEX_SHADER,h.frame.snow._vertexShader),this._screen.compileShader(s.FRAGMENT_SHADER,h.frame.snow._fragmentShader)),this._image=this._screen.createImage(this._width,this._height),this._data=this._image.data,this._texture=this._screen.createTexture(this._image,!0,s.FILTER_LINEAR),this.onresize(this._aspect)},h.frame.snow._vertexShader=null,h.frame.snow._fragmentShader=null,h.frame.snow.load=function(){return new Promise(function(e,t){Promise.all([h.loadShader("frame","snow","shaders.html","vertex"),h.loadShader("frame","snow","shaders.html","fragment")]).then(function(t){h.frame.snow._vertexShader=t[0],h.frame.snow._fragmentShader=t[1],e()},function(){t("snow.load failed")})})},h.frame.snow.prototype.onresize=function(e){this._aspect=e},h.frame.snow.prototype.draw=function(e){var t=1;if(this._controller&&this._controller.slider){t=this._controller.slider;if(t==0)return}var n,r=e|0;r>20&&(r=20);for(n=0;n<r;++n){var i=Math.random()*this._width,o=(Math.random()-.5)*.1,u=Math.random()+.5;this._ps.add(i,o,u,this._image,this._width,this._height)}var a=this._width*this._height*4;for(n=0;n<a;++n)this._data[n]=0;this._ps.update(),this._texture.update(this._image),this._program.setAttributeArray("aCoord",this._coords,0,2,0),this._program.setTexture("uTexture",this._texture),this._program.setUniformVector("uVolume",[t]),this._program.drawArrays(s.MODE_TRIANGLE_FAN,0,4)},h.frame.snow.prototype.setController=function(e){this._controller=e},h.frame.snow.ps=function(){u.apply(this,arguments)},h.frame
.snow.ps.prototype=new u(null,0),h.frame.snow.ps.prototype.constructor=h.frame.snow.ps,h.frame.snow.ps.GRAVITY=.001,h.frame.snow.ps.prototype.initialize=function(e,t,n,r,i,s){this.y=0,this.x=e,this.vx=t,this.vy=n,this.image=r,this.width=i,this.height=s},h.frame.snow.ps.prototype.update=function(){return this.vy+=h.frame.snow.ps.GRAVITY,this.vy*=.999,this.y+=this.vy,this.y>=this.height?!1:(this.x+=this.vx,this.x<0||this.x>=this.width?!1:(this.image.setPixel(this.x|0,this.y|0,255,255,255,255),!0))},h.frame.nicofarre3d.modules.harrier=function(e){this._controller=e.controller,this._zspeed=e.zspeed||10,this._xspeed=e.xspeed||0,this._zinterval=e.zinterval||50,this._xinterval=e.xinterval||0,this._alpha=e.alpha||.1,this._color=e.color||[.4,.4,.6],this._ceil=e.ceil||!0,this._t=0},h.frame.nicofarre3d.modules.harrier.prototype.clear=function(e){e.setAlphaMode(!0,e.gl.DST_COLOR,e.gl.ZERO),e.fill([this._alpha,this._alpha,this._alpha,1])},h.frame.nicofarre3d.modules.harrier.prototype.draw=function(e){this._t+=e.delta,e.setAlphaMode(!0,e.gl.ONE,e.gl.ONE),e.color=[1,1,1,1];var t=1e5,n=1e6,r=0,i=this._t/1e3*this._zspeed,s=5e3;this._controller&&this._controller.volume&&(s*=1+this._controller.volume[0]*10);for(var o=-t;o<t;o+=1e4)r=(1+Math.sin(i+o/t*this._zinterval))/2,e.color=[this._color[0]*r,this._color[1]*r,this._color[2]*r,1],e.drawLine([-n,-s,o],[n,-s,o]),this._ceil&&e.drawLine([-n,s,o],[n,s,o]);i=this._t/1e3*this._xspeed;for(var u=-t;u<t;u+=1e4)r=(1+Math.sin(i))/2,r=(1+Math.sin(i+u/t*this._xinterval))/2,e.color=[this._color[0]*r,this._color[1]*r,this._color[2]*r,1],e.drawLine([u,-s,-n],[u,-s,n]),this._ceil&&e.drawLine([u,s,-n],[u,s,n])},h.frame.nicofarre3d.modules.train=function(e){this._container=new u.Container(h.frame.nicofarre3d.modules.train.Particle),this._period=e.period||500,this._controller=e.controller,this._tick=0,this._nextTime=0,this._frontRails=[],this._backRails=[],this._houseR=0,this._houseL=0,this._offset=0,this._r=0,this._fly=0;for(var t=0;t<30;++t)this._frontRails.push(this._newRail()),this._backRails.push(this._newRail());this._box=o.createCube(),this._box.setDrawMode(s.MODE_LINE_LOOP)},h.frame.nicofarre3d.modules.train.prototype.clear=function(e){e.clear(e.gl.DEPTH_BUFFER_BIT),e.setAlphaMode(!0,e.gl.ONE,e.gl.SRC_ALPHA),e.fill([0,0,0,.7])},h.frame.nicofarre3d.modules.train.prototype.draw=function(e){this._controller&&this._controller.volume&&(this._r=this._controller.volume[0]-.5,this._fly=1e4*this._controller.volume[1]),e.setAlphaMode(!0,e.gl.ONE,e.gl.ONE),this._tick+=e.delta;while(this._tick>=this._nextTime)this._update(),this._nextTime+=this._period;var t=[.1,.1,.1,1];e.color=t;var n=-1e3+this._offset,r=0,i=0;for(var s=0;s<this._frontRails.length;++s){var o=this._frontRails[s];e.drawBox(500,200,[r,-500-this._fly,n],[-Math.PI/2,i,0]);var u=250*Math.cos(i),a=250*Math.sin(i);e.drawBox(800,10,[r+u,-450-this._fly,n-a],[-Math.PI/2,i,Math.PI/2-i]),e.drawBox(800,10,[r-u,-450-this._fly,n+a],[-Math.PI/2,i,Math.PI/2-i]),o.houseR&&(e.color=o.houseRC,e.drawPrimitive(this._box,2e3,o.houseRH,o.houseR,[r+u*20,-500-this._fly,n-a*20],[0,-i,0]),e.color=t),o.houseL&&(e.color=o.houseLC,e.drawPrimitive(this._box,2e3,o.houseLH,o.houseL,[r-u*20,-500-this._fly,n+a*20],[0,-i,0]),e.color=t),n-=1e3*Math.cos(i),r+=1e3*Math.sin(i),i+=o.r}n=0+this._offset,r=0,i=0;for(s=this._backRails.length-1;s>=0;--s){var o=this._backRails[s];e.drawBox(500,200,[r,-500-this._fly,n],[-Math.PI/2,i,0]);var u=250*Math.cos(i),a=250*Math.sin(i);e.drawBox(800,10,[r+u,-450-this._fly,n-a],[-Math.PI/2,i,Math.PI/2-i]),e.drawBox(800,10,[r-u,-450-this._fly,n+a],[-Math.PI/2,i,Math.PI/2-i]),o.houseR&&(e.color=o.houseRC,e.drawPrimitive(this._box,2e3,o.houseRH,o.houseR,[r+u*20,-500-this._fly,n-a*20],[0,-i,0]),e.color=t),o.houseL&&(e.color=o.houseLC,e.drawPrimitive(this._box,2e3,o.houseLH,o.houseL,[r-u*20,-500-this._fly,n+a*20],[0,-i,0]),e.color=t),n+=1e3*Math.cos(i),r-=1e3*Math.sin(i),i-=o.r}},h.frame.nicofarre3d.modules.train.prototype._newRail=function(){var e=0,t=0;this._houseR==0?(this._houseR=2+Math.random()*3|0,e=this._houseR*1e3,t=Math.random()*5e3):this._houseR--;var n=0,r=0;return this._houseL==0?(this._houseL=2+Math.random()*3|0,n=this._houseL*1e3,r=Math.random()*5e3):this._houseL--,{r:this._r,houseR:e,houseRH:t,houseRC:[.02+Math.random()/256,.02+Math.random()/256,.02+Math.random()/256,1],houseL:n,houseLH:r,houseLC:[.02+Math.random()/256,.02+Math.random()/256,.02+Math.random()/256,1]}},h.frame.nicofarre3d.modules.train.prototype._update=function(){this._offset+=250,this._offset==1e3&&(this._offset=0,this._backRails.shift(),this._backRails.push(this._frontRails.shift()),this._frontRails.push(this._newRail()))},h.frame.nicofarre3d.modules.lines=function(e){this._rate=e.rate||.95,this._lines=e.lines||256},h.frame.nicofarre3d.modules.lines.prototype.clear=function(e){e.setAlphaMode(!0,e.gl.DST_COLOR,e.gl.ZERO),e.fill([this._rate,this._rate,this._rate,1])},h.frame.nicofarre3d.modules.lines.prototype.draw=function(e){e.setAlphaMode(!0,e.gl.ONE,e.gl.ONE);for(var t=0;t<this._lines;++t)e.color=[Math.random(),Math.random(),Math.random(),Math.random()],e.drawLine([this._p(),this._p(),this._p()],[this._p(),this._p(),this._p()])},h.frame.nicofarre3d.modules.lines.prototype._p=function(e){return(Math.random()-.5)*1e4},h.frame.nicofarre3d.modules.waypoints=function(e){this._container=new u.Container(h.frame.nicofarre3d.modules.waypoints.Particle),this._waypoints=[],this._size=e.size||4096,this._height=e.height||2048,this._gravity=e.gravity/1e3||.002,this._h=0,this._lastParticles=0,this._maxParticles=e.particles||1e4,this._range=e.range||1e5,this._emit=e.emit||4;var t=e.waypoints||32,n=e.wayspeed||10;for(var r=0;r<t;++r)this._waypoints.push({x:(Math.random()-.5)*2*this._size,y:(Math.random()-.5)*2*this._height,z:(Math.random()-.5)*2*this._size,vx:(Math.random()*2-1)*n,vy:(Math.random()*2-1)*n,vz:(Math.random()*2-1)*n});this._waypoints.push({x:0,y:0,z:0,vx:0,vy:0,vz:0}),this._model=o.createPoints(new Array(this._maxParticles*3))},h.frame.nicofarre3d.modules.waypoints.Particle=function(){u.apply(this,arguments)},h.frame.nicofarre3d.modules.waypoints.Particle.prototype=new u(null,0),h.frame.nicofarre3d.modules.waypoints.Particle.prototype.constructor=h.frame.nicofarre3d.modules.waypoints.Particle,h.frame.nicofarre3d.modules.waypoints.Particle.prototype.initialize=function(e,t,n,i,s){this.x=Math.random()*1e3,this.y=Math.random()*1e3,this.z=Math.random()*1e3,this.ox=this.x,this.oy=this.y,this.oz=this.z;var o=r.HSV2RGB(e,1-Math.random()/4,Math.random()/2);this.color=[o.r/255,o.g/255,o.b/255,1],this.target=0,this.waypoints=t,this.size=n,this.gravity=i,this.range=s},h.frame.nicofarre3d.modules.waypoints.Particle.prototype.update=function(e){var t=this.waypoints[this.target],n=t.x-this.x,r=t.y-this.y,i=t.z-this.z;if(n*n+r*r+i*i<this.range){this.target++;if(this.target==this.waypoints.length)return!1;this.vx+=Math.random()*2-1,this.vy+=Math.random()*2-1,this.vz+=Math.random()*2-1}return this.vx+=n*this.gravity,this.vy+=r*this.gravity,this.vz+=i*this.gravity,this.vx*=.97,this.vy*=.97,this.vz*=.97,this.ox=this.x,this.oy=this.y,this.oz=this.z,this.x+=this.vx,this.y+=this.vy,this.z+=this.vz,!0},h.frame.nicofarre3d.modules.waypoints.prototype.clear=function(e){e.clear(e.gl.DEPTH_BUFFER_BIT),e.setAlphaMode(!0,e.gl.ONE,e.gl.SRC_ALPHA),e.fill([0,0,0,.8])},h.frame.nicofarre3d.modules.waypoints.prototype.draw=function(e){e.setAlphaMode(!0,e.gl.ONE,e.gl.ONE);var t=this._size,n=this._height;for(var r=0;r<this._waypoints.length;++r){var i=this._waypoints[r];i.x+=i.vx,i.y+=i.vy,i.z+=i.vz;if(i.x>t&&i.vx>0||i.x<-t&&i.vx<0)i.vx=-i.vx;if(i.y>n&&i.vy>0||i.y<-n&&i.vy<0)i.vy=-i.vy;if(i.z>t&&i.vz>0||i.z<-t&&i.vz<0)i.vz=-i.vz}var s=Math.min(this._emit,this._maxParticles-this._container.length);for(var o=0;o<s;++o)this._container.add(this._h,this._waypoints,this._size,this._gravity,this._range);this._h=(this._h+1)%360,this._container.update();var u=Math.min(this._maxParticles,this._container.length),a=this._model.getVerticesBuffer(e.screen),f=a.buffer(),l=this._model.getColorsBuffer(e.screen),c=l.buffer();for(o=0;o<u;++o){var h=this._container.at(o);f[o*3+0]=h.x,f[o*3+1]=h.y,f[o*3+2]=h.z,c[o*4+0]=h.color[0],c[o*4+1]=h.color[1],c[o*4+2]=h.color[2],c[o*4+3]=h.color[3]}for(;o<this._lastParticles;++o)f[o*3+0]=0,f[o*3+1]=0,f[o*3+2]=0,c[o*4+0]=0,c[o*4+1]=0,c[o*4+2]=0,c[o*4+3]=0;this._lastParticles=this._container.length,a.update(),l.update(),e.drawPrimitive(this._model,1,1,1,[0,0,0])},h.frame.nicofarre3d.modules.cube=function(){this._n=256,this._objects=new Array(this._n);for(var e=0;e<this._n;++e)this._objects[e]=new h.frame.nicofarre3d.modules.cube.object((Math.random()-.5)*2e4);this._cube=o.createCube(),this._cube.setDrawMode(s.MODE_LINE_LOOP)},h.frame.nicofarre3d.modules.cube.object=function(e){this._init(e)},h.frame.nicofarre3d.modules.cube.object.prototype._init=function(e){this._position=[(Math.random()-.5)*1e4,(Math.random()-.5)*1e3,e],this._size=100;var t=Math.random(),n=Math.random(),r=Math.random(),i=(t+n+r)/3;t=(t+i)/2,n=(t+i)/2,r=(t+i)/2,this._color=[t,n,r,1],this._rotate=Math.random()*Math.PI*2},h.frame.nicofarre3d.modules.cube.object.prototype.draw=function(e,t,n,r){e.color=this._color;var i=this._size;e.drawPrimitive(t,i,i,i,this._position,[this._rotate,0,0]),this._rotate+=n,this._position[2]+=r,this._position[2]>1e4&&this._init(this._position[2]-2e4)},h.frame.nicofarre3d.modules.cube.prototype.clear=function(e){e.color=[0,0,0,1],e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT)},h.frame.nicofarre3d.modules.cube.prototype.draw=function(e){e.color=[0,0,0,1],e.setAlphaMode(!1);var t=e.delta*2,n=t/1e3;for(var r=0;r<this._n;++r)this._objects[r].draw(e,this._cube,n,t)},h.frame.nicofarre3d.modules.roll=function(e){this._api=e.api;var t=e.font||{size:90,name:"Sans",foreground:"rgba(19, 76, 51, 255)",background:"rgba(0, 0, 0, 255"},n=e.headFont||t,r=e.script||[{head:!0,text:"Powered by"},{text:"Takashi Toyoshima"}];this._headScale=e.headScale||1.2,this._ghost=typeof e.ghost!="undefined"?e.ghost:.8;var i=[],s=[];for(var o=0;o<r.length;++o)r[o].head?s.push(r[o].text):i.push(r[o].text);this._normFont=this._api.createFont(t,i.join("")),this._headFont=this._api.createFont(n||t,s.join("")),this._sequencer=new a;var u=e.delay||0,f=u*1e3;for(o=0;o<r.length;++o)this._sequencer.register(f,this._createTextLineTask(r[o])),f+=3e3;this._sequencer.start()},h.frame.nicofarre3d.modules.roll.prototype.clear=function(e){var t=this._ghost;e.setAlphaMode(!0,e.gl.DST_COLOR,e.gl.ZERO),e.fill([t,t,t,1])},h.frame.nicofarre3d.modules.roll.prototype.draw=function(e){e.setAlphaMode(!0,e.gl.ONE,e.gl.ONE),this._sequencer.run(e.delta)},h.frame.nicofarre3d.modules.roll.prototype._createTextLineTask=function(e){var t=new a.ParallelTask,n=0,r=e.text,i=e.head?this._headFont:this._normFont,s=e.head?this._headScale:1;for(var o=0;o<r.length;++o)n+=i[r[o]].width*s;var u=-n/2;for(o=0;o<r.length;++o){var f=i[r[o]].width*s;t.append(new h.frame.nicofarre3d.modules.roll.Cell(this._api,i,r[o],u+f/2,s,100*o)),u+=f}return t},h.frame.nicofarre3d.modules.roll.Cell=function(e,t,n,r,i,s){this._api=e,this._font=t,this._scale=i,this._sx=(Math.random()-.5)*1e4,this._sy=(Math.random()-.5)*3e3,this._sz=Math.random()*5e3,this._dx=r,this._dy=-50,this._dz=-1e3,this._rx=r,this._ry=0,this._rz=-2e3,this._vy=.5,this._vz=-1,this._c=n,this._time=0,this._appearDuration=1e3,this._stopDuration=3e3,this._wipeoutDuration=100,this._wipeDuration=1e3,this._wipeinDuration=100,this._rollDuration=1e4,this.SerialTask(),this.append(new a.Task(s)),this.append(new a.Task(0,this._reset.bind(this))),this.append(new a.Task(this._appearDuration,this._appear.bind(this))),this.append(new a.Task(0,this._reset.bind(this))),this.append(new a.Task(0,this._reset.bind(this))),this.append(new a.Task(this._stopDuration-s,this._stop.bind(this))),this.append(new a.Task(0,this._reset.bind(this))),this.append(new a.Task(this._wipeoutDuration,this._wipeout.bind(this))),this.append(new a.Task(0,this._reset.bind(this))),this.append(new a.Task(this._wipeDuration)),this.append(new a.Task(0,this._reset.bind(this))),this.append(new a.Task(this._wipeinDuration,this._wipein.bind(this))),this.append(new a.Task(0,this._reset.bind(this))),this.append(new a.Task(this._rollDuration,this._roll.bind(this)))},h.frame.nicofarre3d.modules.roll.Cell.prototype=new a.SerialTask,h.frame.nicofarre3d.modules.roll.Cell.prototype.SerialTask=a.SerialTask,h.frame.nicofarre3d.modules.roll.Cell.prototype.constructor=h.frame.nicofarre3d.modules.roll.Cell,h.frame.nicofarre3d.modules.roll.Cell.prototype._reset=function(e,t){this._time=t},h.frame.nicofarre3d.modules.roll.Cell.prototype._appear=function(e,t){var n=(t-this._time)/this._appearDuration,r=1-n,i=[this._sx*r+this._dx*n,this._sy*r+this._dy*n,this._sz*r+this._dz*n];this._api.drawCharacter(this._font,this._c,this._scale,this._scale,i)},h.frame.nicofarre3d.modules.roll.Cell.prototype._stop=function(e,t){this._api.drawCharacter(this._font,this._c,this._scale,this._scale,[this._dx,this._dy,this._dz])},h.frame.nicofarre3d.modules.roll.Cell.prototype._wipeout=function(e,t){var n=(t-this._time)/this._wipeoutDuration,r=1-n;this._api.drawCharacter(this._font,this._c,this._scale*(1+n*2.5),this._scale*r,[this._dx*(1+n*5),this._dy,this._dz])},h.frame.nicofarre3d.modules.roll.Cell.prototype._wipein=function(e,t){var n=(t-this._time)/this._wipeinDuration,r=1-n;this._api.drawCharacter(this._font,this._c,this._scale*(1+r*2.5),this._scale*r,[this._rx*(1+r*5),this._ry,this._rz],[-Math.PI/3,0,0]),this._ry+=this._vy*e/20,this._rz+=this._vz*e/20},h.frame.nicofarre3d.modules.roll.Cell.prototype._roll=function(e,t){this._api.drawCharacter(this._font,this._c,this._scale,this._scale,[this._rx,this._ry,this._rz],[-Math.PI/4,0,0]),this._ry+=this._vy*e/20,this._rz+=this._vz*e/20},h.frame.nicofarre3d.modules.beams=function(e){this._container=new u.Container(h.frame.nicofarre3d.modules.beams.Particle),this._period=e.period||1e3,this._unit=e.unit||20,this._dir=e.dir||h.frame.nicofarre3d.modules.beams.DIR_ALL,this._tick=0,this._nextTime=0,this._beams=[],this._size=16384,this._speed=e.speed||this._size/200,this._maxParticles=1e4,this._lastParticles=0,this._model=o.createPoints(new Array(this._maxParticles*3))},h.frame.nicofarre3d.modules.beams.Particle=function(){u.apply(this,arguments)},h.frame.nicofarre3d.modules.beams.Particle.prototype=new u(null,0),h.frame.nicofarre3d.modules.beams.Particle.prototype.constructor=h.frame.nicofarre3d.modules.beams.Particle,h.frame.nicofarre3d.modules.beams.DIR_ALL=[0,1,2,3],h.frame.nicofarre3d.modules.beams.DIR_Z=[0,1],h.frame.nicofarre3d.modules.beams.DIR_F2B=[0],h.frame.nicofarre3d.modules.beams.DIR_B2F=[1],h.frame.nicofarre3d.modules.beams.DIR_X=[2,3],h.frame.nicofarre3d.modules.beams.DIR_L2R=[2],h.frame.nicofarre3d.modules.beams.DIR_R2L=[3],h.frame.nicofarre3d.modules.beams.Particle.prototype.initialize=function(e,t,n){var r=(0|n.length*Math.random())%n.length;switch(n[r]){case 0:this.x=(Math.random()-.5)*e,this.y=(Math.random()-.5)*e/10,this.z=-e,this.vx=0,this.vy=0,this.vz=t;break;case 1:this.x=(Math.random()-.5)*e,this.y=(Math.random()-.5)*e/10,this.z=e,this.vx=0,this.vy=0,this.vz=-t;break;case 2:this.x=-e,this.y=(Math.random()-.5)*e/10,this.z=(Math.random()-.5)*e,this.vx=t,this.vy=0,this.vz=0;break;case 3:this.x=e,this.y=(Math.random()-.5)*e/10,this.z=(Math.random()-.5)*e,this.vx=-t,this.vy=0,this.vz=0}this.x-=this.x%1e3,this.y-=this.x%1e3,this.z-=this.x%1e3,this.color=[Math.random(),Math.random(),Math.random(),1],this.size=e},h.frame.nicofarre3d.modules.beams.Particle.prototype.update=function(e){var t=e/17;this.x+=this.vx*t,this.y+=this.vy*t,this.z+=this.vz*t;var n=this.size/10;return this.x>this.size&&this.vx>0||this.x<-this.size&&this.vx<0?!1:this.y>n&&this.vy>0||this.y<-n&&this.vy<0?!1:this.z>this.size&&this.vz>0||this.z<-this.size&&this.vz<0?!1:!0},h.frame.nicofarre3d.modules.beams.prototype.clear=function(e){e.clear(e.gl.DEPTH_BUFFER_BIT),e.setAlphaMode(!0,e.gl.ONE,e.gl.SRC_ALPHA),e.fill([0,0,0,.92])},h.frame.nicofarre3d.modules.beams.prototype.draw=function(e){var t=this._size,n=t/10;this._tick+=e.delta;while(this._tick>this._nextTime){this._nextTime+=this._period;var r=Math.min(this._unit,this._maxParticles-this._container.length);for(var i=0;i<r;++i)this._container.add(this._size,this._speed,this._dir)}this._container.update(e.delta);var s=Math.min(this._maxParticles,this._container.length),o=this._model.getVerticesBuffer(e.screen),u=o.buffer(),a=this._model.getColorsBuffer(e.screen),f=a.buffer();for(i=0;i<s;++i){var l=this._container.at(i);u[i*3+0]=l.x,u[i*3+1]=l.y,u[i*3+2]=l.z,f[i*4+0]=l.color[0],f[i*4+1]=l.color[1],f[i*4+2]=l.color[2],f[i*4+3]=l.color[3]}for(;i<this._lastParticles;++i)u[i*3+0]=0,u[i*3+1]=0,u[i*3+2]=0,f[i*4+0]=0,f[i*4+1]=0,f[i*4+2]=0,f[i*4+3]=0;this._lastParticles=this._container.length,o.update(),a.update(),e.drawPrimitive(this._model,1,1,1,[0,0,0])},this.majvj=e,this.tma=n,this.create=function(e,t,n,r){return new h(e,t,n,r)};var w={};this.loadPlugin=function(e,t){return new Promise(function(r,i){if(!h[e])return i("unknown plugin type: "+e);if(!h[e][t])return i("unknown plugin: "+e+"/"+t);if(w[e]&&w[e][t])return r(h[e][t]);w[e]||(w[e]={}),h[e][t].load||(w[e][t]=h[e][t],r(h[e][t])),h[e][t].load().then(function(){w[e][t]=h[e][t],r(h[e][t])},n.ecb)})},this.loadAllPlugins=function(e){e&&(n.base=e);var t=Object.keys(h.effect).map(function(e){return this.loadPlugin("effect",e)}.bind(this)),r=Object.keys(h.frame).map(function(e){return this.loadPlugin("frame",e)}.bind(this));return Promise.all(t.concat(r))},this.setBase=function(e){n.base=e};if(this.name){this.setBase(this.base),0==this.width&&(this.width=240),0==this.height&&(this.height=135);var E=function(){var e=this.create(this.width,this.height,!1,this.$.main),t=e.create(this.type,this.name);e.run(function(r){e.screen().fillColor(0,0,0,1);try{t.draw(r)}catch(i){n.error(i.stack)}})}.bind(this);this.type=="scene"?this.loadAllPlugins().then(function(){this.loadPlugin(this.type,this.name).then(E,n.ecb)}.bind(this),n.ecb):this.loadPlugin(this.type,this.name).then(E,n.ecb)}}});